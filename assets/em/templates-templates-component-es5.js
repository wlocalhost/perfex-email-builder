function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var a=[],n=!0,i=!1,c=void 0;try{for(var o,r=e[Symbol.iterator]();!(n=(o=r.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(l){i=!0,c=l}finally{try{n||null==r.return||r.return()}finally{if(i)throw c}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{BsGo:function(e,t,a){"use strict";a.r(t),a.d(t,"TemplatesComponent",(function(){return Le}));var n,i=a("XNiG"),c=a("2Vo4"),o=a("xgIS"),r=a("LRne"),l=a("cp0P"),b=a("itXk"),s=a("Cfvw"),u=a("EY2u"),d=a("pLZG"),m=a("XqQ8"),p=a("lJxs"),f=a("vkgz"),g=a("1G5W"),h=a("eIep"),v=a("IzEk"),y=a("JIr8"),w=a("nYR2"),P=a("uSps"),O=a("z6cu"),C=a("UXun"),k=a("fXoL"),j=a("tk/3"),Q=a("dNgK"),x=((n=function(){function e(t,a){_classCallCheck(this,e),this.http=t,this.matSnack=a,this._isLoading$=new i.a,this.isLoading$=this._isLoading$.asObservable()}return _createClass(e,[{key:"httpRequest",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"get",i=arguments.length>3?arguments[3]:void 0;return this._isLoading$.next(!0),this.matSnack.open("Please wait..."),this.http.request(n,"".concat(globalThis.NGB.baseUrl,"/").concat(e),{params:a,body:i,responseType:"json"}).pipe(Object(y.a)((function(e){return e.error instanceof ErrorEvent?console.error("An error occurred:",e.error.message):(console.error("Backend returned code ".concat(e.status)),t.matSnack.open('Something bad happened; please try again later. "Error Status '.concat(e.status,'".'),"Close",{announcementMessage:"Something bad happened; please try again later."})),console.error(e),Object(O.a)(new Error("Something bad happened; please try again later."))})),Object(f.a)((function(){return t.matSnack.dismiss()})),Object(w.a)((function(){return t._isLoading$.next(!1)})))}},{key:"getTemplatesByLang",value:function(e){return this.httpRequest("templates",{language:e})}},{key:"getTemplateBody",value:function(e){return this.httpRequest("getEmailTemplate",{id:e})}},{key:"getTemplate",value:function(e){return this.httpRequest("getTemplate",{id:e})}},{key:"revertTemplate",value:function(e){return this.sendPostRequest(new FormData,"revertTemplate/".concat(e)).pipe(Object(p.a)((function(e){return{isEdited:!1,email:new P.a({structures:[new P.f("cols_1",[[new P.g(e.message)]])]})}})))}},{key:"getAllLanguages",value:function(){return this.httpRequest("languages").pipe(Object(C.a)(),Object(y.a)((function(){return Object(r.a)([])})))}},{key:"getAllMergeFields",value:function(e){return this.httpRequest("mergeFields",{type:e}).pipe(Object(y.a)((function(){return Object(r.a)([])})))}},{key:"sendPostRequest",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new FormData,t=arguments.length>1?arguments[1]:void 0,a=globalThis.NGB.csrf,n=a.token,i=a.name;return e.append(i,n),this.httpRequest(t,{},"post",e)}}]),e}()).\u0275fac=function(e){return new(e||n)(k.Ub(j.a),k.Ub(Q.a))},n.\u0275prov=k.Gb({token:n,factory:n.\u0275fac,providedIn:"any"}),n),A=a("0IaG"),T=a("ofXK"),_=a("XiUz"),$=a("bTqV"),L=a("3Pt+"),I=a("kmnG"),S=a("qFsG"),D=a("MutI"),M=a("f0Cb");function F(e,t){1&e&&(k.Ob(0),k.Qb(1,"h2",2),k.Cc(2,"Are you sure?"),k.Pb(),k.Qb(3,"mat-dialog-content"),k.Cc(4," You are about to close the builder, but there're unsaved changes, which will be lost. Are you sure? "),k.Pb(),k.Qb(5,"mat-dialog-actions",3),k.Qb(6,"button",4),k.Cc(7," No, Go back! "),k.Pb(),k.Qb(8,"button",5),k.Cc(9," Yes, Close it. "),k.Pb(),k.Pb(),k.Nb()),2&e&&(k.wb(8),k.ic("mat-dialog-close",!0))}function E(e,t){1&e&&(k.Ob(0),k.Qb(1,"h2",2),k.Cc(2,"Are you sure?"),k.Pb(),k.Qb(3,"mat-dialog-content"),k.Qb(4,"p"),k.Cc(5,"You are about to restore this template to default Perfex template, all additional changes will be lost."),k.Pb(),k.Qb(6,"p"),k.Qb(7,"strong"),k.Qb(8,"strong"),k.Cc(9,"This will affect only template body, not name nor subject."),k.Pb(),k.Pb(),k.Pb(),k.Qb(10,"p"),k.Qb(11,"strong"),k.Cc(12,"Are you sure?"),k.Pb(),k.Pb(),k.Pb(),k.Qb(13,"mat-dialog-actions",3),k.Qb(14,"button",4),k.Cc(15," No, Go back! "),k.Pb(),k.Qb(16,"button",5),k.Cc(17," Yes, Restore it. "),k.Pb(),k.Pb(),k.Nb()),2&e&&(k.wb(16),k.ic("mat-dialog-close",!0))}function R(e,t){if(1&e&&(k.Qb(0,"mat-list-item"),k.Qb(1,"div",16),k.Qb(2,"span"),k.Cc(3),k.Pb(),k.Qb(4,"code"),k.Cc(5),k.Pb(),k.Pb(),k.Pb()),2&e){var a=k.cc().$implicit;k.wb(3),k.Dc(a.name),k.wb(2),k.Dc(a.key)}}function N(e,t){1&e&&k.Lb(0,"mat-divider")}function G(e,t){if(1&e&&(k.Ob(0),k.Ac(1,R,6,2,"mat-list-item",1),k.Ac(2,N,1,0,"mat-divider",1),k.Nb()),2&e){var a=t.$implicit;k.wb(1),k.ic("ngIf",a.key),k.wb(1),k.ic("ngIf",a.key)}}function Y(e,t){if(1&e&&(k.Qb(0,"mat-list",14),k.Ac(1,G,3,2,"ng-container",15),k.Pb()),2&e){var a=k.cc(2);k.wb(1),k.ic("ngForOf",a.data.mergeFields)}}function q(e,t){if(1&e&&(k.Ob(0),k.Qb(1,"h2",2),k.Cc(2,"Edit details"),k.Pb(),k.Qb(3,"mat-dialog-content"),k.Qb(4,"form",null,6),k.Lb(6,"input",7),k.Qb(7,"mat-form-field",8),k.Qb(8,"mat-label"),k.Cc(9,"From Name"),k.Pb(),k.Lb(10,"input",9),k.Pb(),k.Qb(11,"mat-form-field",8),k.Qb(12,"mat-label"),k.Cc(13,"Subject"),k.Pb(),k.Lb(14,"input",10),k.Pb(),k.Pb(),k.Ac(15,Y,2,1,"mat-list",11),k.Pb(),k.Qb(16,"mat-dialog-actions",3),k.Qb(17,"button",12),k.Cc(18," Cancel "),k.Pb(),k.Qb(19,"button",13),k.Cc(20," Save "),k.Pb(),k.Pb(),k.Nb()),2&e){var a=k.oc(5),n=k.cc();k.wb(6),k.ic("value",n.data.data.emailtemplateid),k.wb(4),k.ic("value",n.data.data.fromname),k.wb(4),k.ic("value",n.data.data.subject),k.wb(1),k.ic("ngIf",n.data.mergeFields),k.wb(4),k.ic("disabled",!n.checkValidity(a))("mat-dialog-close",a)}}function B(e,t){if(1&e&&(k.Ob(0),k.Qb(1,"h2",2),k.Cc(2,"Send test email"),k.Pb(),k.Qb(3,"mat-dialog-content"),k.Lb(4,"form",null,17),k.Pb(),k.Qb(6,"mat-dialog-actions",3),k.Qb(7,"button",4),k.Cc(8," No, Go back! "),k.Pb(),k.Qb(9,"button",5),k.Cc(10," Yes, Close it. "),k.Pb(),k.Pb(),k.Nb()),2&e){var a=k.oc(5);k.wb(9),k.ic("mat-dialog-close",a)}}var z,U,H=((z=function(){function e(t){_classCallCheck(this,e),this.data=t}return _createClass(e,[{key:"checkValidity",value:function(e){return e.checkValidity()}}]),e}()).\u0275fac=function(e){return new(e||z)(k.Kb(A.a))},z.\u0275cmp=k.Eb({type:z,selectors:[["app-modal-dialog"]],decls:5,vars:4,consts:[[1,"mat-typography"],[4,"ngIf"],["mat-dialog-title",""],["fxLayoutAlign","space-between center"],["mat-button","","color","warn","cdkFocusInitial","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["form",""],["type","hidden","name","emailtemplateid",3,"value"],["appearance","fill"],["matInput","","name","fromname","required","","type","text",3,"value"],["matInput","","name","subject","required","","type","text",3,"value"],["dense","",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary","cdkFocusInitial","",3,"disabled","mat-dialog-close"],["dense",""],[4,"ngFor","ngForOf"],["fxFlex","","fxLayout","","fxLayoutAlign","space-between center"],["form","ngForm"]],template:function(e,t){1&e&&(k.Qb(0,"div",0),k.Ac(1,F,10,1,"ng-container",1),k.Ac(2,E,18,1,"ng-container",1),k.Ac(3,q,21,6,"ng-container",1),k.Ac(4,B,11,1,"ng-container",1),k.Pb()),2&e&&(k.wb(1),k.ic("ngIf","confirm"===t.data.type),k.wb(1),k.ic("ngIf","confirm-revert"===t.data.type),k.wb(1),k.ic("ngIf","edit"===t.data.type),k.wb(1),k.ic("ngIf","test-email"===t.data.type))},directives:[T.i,A.h,A.e,A.c,_.b,$.a,A.d,L.n,L.i,L.j,I.b,I.f,S.a,D.a,T.h,D.c,_.a,_.c,M.a],styles:["[_nghost-%COMP%]{display:block}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;height:auto}mat-list[_ngcontent-%COMP%]{max-height:300px;overflow:auto}mat-list[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all}"]}),z),W=a("XhcP"),X=a("/t3+"),K=a("STbY"),J=a("7EHt"),V=a("bv9b"),Z=a("+0xr"),ee=a("1jcm"),te=a("Qu3c"),ae=a("NFeN"),ne=((U=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e){return e.split("_").join(" ")}}]),e}()).\u0275fac=function(e){return new(e||U)},U.\u0275pipe=k.Jb({name:"keyToLang",type:U,pure:!0}),U),ie=["sidenav"];function ce(e,t){1&e&&k.Lb(0,"mat-progress-bar",14)}function oe(e,t){if(1&e&&(k.Qb(0,"button",15),k.Cc(1),k.Pb()),2&e){var a=t.ngIf;k.wb(1),k.Ec(" ",a," ")}}function re(e,t){if(1&e){var a=k.Rb();k.Ob(0),k.Qb(1,"button",18),k.Yb("click",(function(){k.rc(a);var e=t.$implicit;return k.cc(3).changeLanguage(e)})),k.Cc(2),k.dc(3,"keyToLang"),k.Pb(),k.Nb()}if(2&e){var n=t.$implicit;k.wb(2),k.Ec(" ",k.ec(3,1,n)," ")}}function le(e,t){if(1&e&&k.Ac(0,re,4,3,"ng-container",17),2&e){var a=k.cc().ngIf;k.ic("ngForOf",a)}}function be(e,t){1&e&&k.Ac(0,le,1,1,"ng-template",16)}function se(e,t){1&e&&k.Lb(0,"mat-header-cell")}function ue(e,t){if(1&e){var a=k.Rb();k.Qb(0,"mat-cell"),k.Qb(1,"mat-slide-toggle",33),k.Yb("change",(function(e){k.rc(a);var n=t.$implicit;return k.cc(2).changeActiveStatus(e,n)})),k.dc(2,"async"),k.Pb(),k.Pb()}if(2&e){var n=t.$implicit,i=k.cc(2);k.wb(1),k.ic("checked",n.active-0==1)("disabled",k.ec(2,2,i.res.isLoading$))}}function de(e,t){1&e&&(k.Qb(0,"mat-header-cell"),k.Cc(1,"Name"),k.Pb())}function me(e,t){if(1&e&&(k.Qb(0,"span"),k.Cc(1),k.Pb()),2&e){var a=k.cc().$implicit;k.wb(1),k.Dc(a.name)}}function pe(e,t){if(1&e&&(k.Qb(0,"del"),k.Cc(1),k.Pb()),2&e){var a=k.cc().$implicit;k.wb(1),k.Dc(a.name)}}function fe(e,t){if(1&e&&(k.Qb(0,"mat-cell"),k.Ac(1,me,2,1,"span",8),k.Ac(2,pe,2,1,"del",8),k.Pb()),2&e){var a=t.$implicit;k.wb(1),k.ic("ngIf","1"===a.active),k.wb(1),k.ic("ngIf","1"!==a.active)}}function ge(e,t){1&e&&(k.Qb(0,"mat-header-cell"),k.Cc(1," From Name > Subject "),k.Pb())}function he(e,t){if(1&e&&(k.Qb(0,"span"),k.Cc(1),k.Pb()),2&e){var a=k.cc().$implicit;k.wb(1),k.Ec(" ",a.fromname," > ")}}function ve(e,t){if(1&e){var a=k.Rb();k.Qb(0,"mat-cell",34),k.Qb(1,"div"),k.Ac(2,he,2,1,"span",8),k.Cc(3),k.Pb(),k.Qb(4,"div",35),k.Qb(5,"span",36),k.Cc(6),k.dc(7,"date"),k.Pb(),k.Qb(8,"button",37),k.Yb("click",(function(){k.rc(a);var e=t.$implicit,n=k.cc().$implicit;return k.cc().changeElementDetails(e,n.key)})),k.dc(9,"async"),k.Qb(10,"mat-icon"),k.Cc(11,"edit"),k.Pb(),k.Pb(),k.Pb(),k.Pb()}if(2&e){var n=t.$implicit,i=k.cc(2);k.wb(2),k.ic("ngIf",n.fromname),k.wb(1),k.Ec(" ",n.subject," "),k.wb(3),k.Ec(" ",k.fc(7,4,i.getUpdatedDate(n),"short")," "),k.wb(2),k.ic("disabled",k.ec(9,7,i.res.isLoading$))}}function ye(e,t){1&e&&(k.Qb(0,"mat-header-cell",38),k.Cc(1," Actions "),k.Pb())}function we(e,t){1&e&&(k.Qb(0,"mat-icon"),k.Cc(1," visibility "),k.Pb())}function Pe(e,t){1&e&&(k.Qb(0,"mat-icon"),k.Cc(1," visibility_off "),k.Pb())}function Oe(e,t){if(1&e){var a=k.Rb();k.Qb(0,"mat-cell",39),k.Qb(1,"button",40),k.Yb("click",(function(){k.rc(a);var e=t.$implicit,n=k.cc().$implicit;return k.cc().editTemplate(e,n.key)})),k.dc(2,"async"),k.Qb(3,"mat-icon"),k.Cc(4,"dashboard"),k.Pb(),k.Pb(),k.Qb(5,"button",41),k.Yb("click",(function(){k.rc(a);var e=t.$implicit,n=k.cc().$implicit;return k.cc().previewTemplate(e,n.key)})),k.dc(6,"async"),k.Ac(7,we,2,0,"mat-icon",8),k.Ac(8,Pe,2,0,"mat-icon",8),k.Pb(),k.Pb()}if(2&e){var n=t.$implicit,i=k.cc(2);k.wb(1),k.ic("disabled",k.ec(2,4,i.res.isLoading$)),k.wb(4),k.ic("disabled",k.ec(6,6,i.res.isLoading$)),k.wb(2),k.ic("ngIf",n.active-0==1),k.wb(1),k.ic("ngIf",n.active-0==0)}}function Ce(e,t){1&e&&k.Lb(0,"mat-header-row")}function ke(e,t){1&e&&k.Lb(0,"mat-row")}function je(e,t){if(1&e){var a=k.Rb();k.Qb(0,"mat-expansion-panel",19),k.Yb("opened",(function(){k.rc(a);var e=t.$implicit;return k.cc().expansionPanelOpen(e.key)})),k.Qb(1,"mat-expansion-panel-header"),k.Qb(2,"mat-panel-title",20),k.Cc(3),k.dc(4,"keyToLang"),k.Pb(),k.Pb(),k.Qb(5,"mat-table",21),k.Ob(6,22),k.Ac(7,se,1,0,"mat-header-cell",23),k.Ac(8,ue,3,4,"mat-cell",24),k.Nb(),k.Ob(9,25),k.Ac(10,de,2,0,"mat-header-cell",23),k.Ac(11,fe,3,2,"mat-cell",24),k.Nb(),k.Ob(12,26),k.Ac(13,ge,2,0,"mat-header-cell",23),k.Ac(14,ve,12,9,"mat-cell",27),k.Nb(),k.Ob(15,28),k.Ac(16,ye,2,0,"mat-header-cell",29),k.Ac(17,Oe,9,8,"mat-cell",30),k.Nb(),k.Ac(18,Ce,1,0,"mat-header-row",31),k.Ac(19,ke,1,0,"mat-row",32),k.Pb(),k.Pb()}if(2&e){var n=t.$implicit,i=k.cc();k.ic("expanded",n.key===i.expansionPanelOpen()),k.wb(3),k.Ec(" ",k.ec(4,5,n.key)," "),k.wb(2),k.ic("dataSource",n.value),k.wb(13),k.ic("matHeaderRowDef",i.displayedColumns),k.wb(1),k.ic("matRowDefColumns",i.displayedColumns)}}function Qe(e,t){1&e&&(k.Qb(0,"span"),k.Cc(1,"\xa0[Unedited]"),k.Pb())}function xe(e,t){if(1&e){var a=k.Rb();k.Ob(0),k.Qb(1,"mat-toolbar",42),k.Qb(2,"mat-toolbar-row"),k.Qb(3,"span"),k.Cc(4),k.Pb(),k.Ac(5,Qe,2,0,"span",8),k.Qb(6,"button",43),k.Yb("click",(function(){k.rc(a);var e=k.cc().ngIf;return k.cc().openBuilderFromPreview(e)})),k.Cc(7," Edit it on builder "),k.Pb(),k.Pb(),k.Pb(),k.Lb(8,"ip-preview-template",44),k.Nb()}if(2&e){var n=k.cc().ngIf;k.wb(4),k.Dc(n.name),k.wb(1),k.ic("ngIf",!n.is_edited),k.wb(3),k.ic("template",n.html)}}function Ae(e,t){if(1&e){var a=k.Rb();k.Ob(0),k.Qb(1,"mat-toolbar",42),k.Qb(2,"mat-toolbar-row"),k.Qb(3,"span"),k.Cc(4),k.Pb(),k.Qb(5,"div",45),k.Qb(6,"button",46),k.Yb("click",(function(){return k.rc(a),k.cc(2).backdropClick()})),k.Cc(7," Close Builder "),k.Pb(),k.Pb(),k.Pb(),k.Pb(),k.Qb(8,"ip-email-builder",47),k.Qb(9,"div",48),k.Qb(10,"button",49),k.Yb("click",(function(){k.rc(a);var e=k.cc().ngIf;return k.cc().saveEmail(e)})),k.Cc(11," Save "),k.Pb(),k.Qb(12,"button",46),k.Yb("click",(function(){return k.rc(a),k.cc(2).revertTemplateBack()})),k.Cc(13," Revert Template "),k.Pb(),k.Pb(),k.Pb(),k.Nb()}if(2&e){var n=k.cc().ngIf;k.wb(4),k.Dc(n.name),k.wb(4),k.ic("email",n.template)}}function Te(e,t){if(1&e&&(k.Ob(0),k.Ac(1,xe,9,3,"ng-container",8),k.Ac(2,Ae,14,2,"ng-container",8),k.Nb()),2&e){var a=t.ngIf;k.wb(1),k.ic("ngIf",a.html),k.wb(1),k.ic("ngIf",a.template)}}function _e(){return Object(d.a)((function(e){return null!==e}))}var $e,Le=(($e=function(){function e(t,a,n,s){var u=this;_classCallCheck(this,e),this.res=t,this.ngb=a,this.dialog=n,this.el=s,this.onDestroy$=new i.a,this.activeLanguage$=new c.a(globalThis.NGB.activeLanguage),this.previewTemplate$=new c.a(null),this.editTemplateObject$=new c.a(null),this.updatedStore=new Map,this.removeUpdatedStore=new Set,this.displayedColumns=["active","name","subject","actions"],this.languages$=this.res.getAllLanguages().pipe(Object(m.a)((function(e){return u.getActiveLanguage$.pipe(Object(p.a)((function(t){return[].concat(_toConsumableArray(e),[globalThis.NGB.activeLanguage]).filter((function(e){return e!==t})).sort()})))}))),this.getActiveLanguage$=this.activeLanguage$.asObservable(),this.keyDowns$=Object(o.a)(this.el.nativeElement,"keydown").pipe(Object(f.a)((function(e){u.sidenav.opened&&e.stopImmediatePropagation()})),Object(g.a)(this.onDestroy$)),this.getTemplates$=this.getActiveLanguage$.pipe(Object(m.a)((function(e){return u.res.getTemplatesByLang(e)})),Object(g.a)(this.onDestroy$)),this.getTemplateObject$=this.editTemplateObject$.pipe(Object(m.a)((function(e){return e?Object(l.a)([u.res.getTemplate(e.id),u.res.getAllMergeFields(e.type)]).pipe(Object(p.a)((function(t){var a=_slicedToArray(t,2),n=a[0],i=a[1];return u.ngb.MergeTags=new Set(i.map((function(e){return e.key}))),Object.assign(Object.assign({},e),{template:new P.a(Object.assign({structures:[new P.f("cols_1",[[new P.g(n.template.message)]])]},n.template))})})),Object(f.a)((function(){u.previewTemplate$.next(null),u.sidenav.open()}))):Object(r.a)(null)})),Object(g.a)(this.onDestroy$)),this.getPreviewTemplate$=this.previewTemplate$.pipe(Object(m.a)((function(e){return e?u.res.getTemplateBody(e.id).pipe(Object(p.a)((function(t){return Object.assign(Object.assign({},e),t)})),Object(f.a)((function(){u.editTemplateObject$.next(null),u.sidenav.open()}))):Object(r.a)(null)})),Object(g.a)(this.onDestroy$)),this.sidenavDetails$=Object(b.a)([this.getTemplateObject$,this.getPreviewTemplate$]).pipe(Object(p.a)((function(e){var t=_slicedToArray(e,2),a=t[0],n=t[1];return a||n})))}return _createClass(e,[{key:"changeLanguage",value:function(e){this.activeLanguage$.next(e)}},{key:"editTemplate",value:function(e,t){this.editTemplateObject$.next({id:e.emailtemplateid,type:t,name:e.name})}},{key:"previewTemplate",value:function(e,t){this.previewTemplate$.next({id:e.emailtemplateid,type:t,name:e.name})}},{key:"closeSidenav",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Object(r.a)("").pipe(Object(h.a)((function(){return t&&e.ngb.hasChanges?e.dialog.open(H,{data:{type:"confirm"},width:"300px",maxWidth:"100%"}).afterClosed().pipe(Object(p.a)(Boolean)):Object(r.a)(!0)})),Object(m.a)((function(t){return t?Object(s.a)(e.sidenav.close()).pipe(Object(p.a)((function(){return!0}))):Object(r.a)(!1)})))}},{key:"backdropClick",value:function(){return this.closeSidenav().pipe(Object(v.a)(1)).subscribe()}},{key:"getUpdatedDate",value:function(e){var t=e.emailtemplateid;return this.removeUpdatedStore.has(t)?null:this.updatedStore.get(t)||e.updated_at||null}},{key:"openBuilderFromPreview",value:function(e){var t=this,a=e.id,n=e.name,i=e.type;return this.closeSidenav(!1).pipe(Object(v.a)(1)).subscribe((function(e){e&&t.editTemplateObject$.next({id:a,name:n,type:i})}))}},{key:"expansionPanelOpen",value:function(e){return e&&localStorage.setItem("expansionPanelOpened",e),localStorage.getItem("expansionPanelOpened")||"client"}},{key:"saveEmail",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new FormData;return this.editTemplateObject$.pipe(_e(),Object(m.a)((function(e){return n.append("emailtemplateid",e.id),t.ngb.saveEmail().pipe(Object(m.a)((function(e){var a=e.html;return n.append("emailObject",JSON.stringify(t.ngb.Email)),n.append("template",a),t.res.sendPostRequest(n,"update")})),Object(y.a)((function(e){return console.error(e),t.ngb.notify("Something bad happened."),u.a})),Object(w.a)((function(){return t.updatedStore.set(e.id,new Date)})))})),Object(m.a)((function(e){var n=e.success;return n&&a?t.closeSidenav(!1):Object(r.a)(n)})),Object(v.a)(1)).subscribe((function(a){a&&(e.isEdited=!0,t.ngb.notify("Email template has been saved successfully."))}))}},{key:"changeActiveStatus",value:function(e,t){var a=this,n=e.checked,i=e.source,c=n?1:0,o=new FormData;return o.append("emailtemplateid",t.emailtemplateid),o.append("active",String(c)),this.res.sendPostRequest(o,"changeActiveStatus").pipe(Object(y.a)((function(){return i.toggle(),u.a})),Object(v.a)(1)).subscribe((function(e){e.success?(t.active=c,a.updatedStore.set(t.emailtemplateid,new Date)):i.toggle()}))}},{key:"changeElementDetails",value:function(e,t){var a=this;return this.res.getAllMergeFields(t).pipe(Object(h.a)((function(t){return a.dialog.open(H,{data:{type:"edit",data:e,mergeFields:t},width:"450px",maxWidth:"100%"}).afterClosed()})),Object(m.a)((function(e){if(!e)return Object(r.a)({success:!1,updates:null});var t=new FormData(e);return a.res.sendPostRequest(t,"updateDetails")}))).subscribe((function(t){var n=t.success,i=t.updates;n&&i&&(e.subject=i.subject,e.fromname=i.fromname,a.updatedStore.set(e.emailtemplateid,new Date),a.ngb.notify("The details have been saved."))}))}},{key:"revertTemplateBack",value:function(){var e=this;return this.editTemplateObject$.pipe(_e(),Object(h.a)((function(t){var a=t.id;return e.dialog.open(H,{data:{type:"confirm-revert"},width:"300px",maxWidth:"100%"}).afterClosed().pipe(Object(p.a)(Boolean),Object(d.a)((function(e){return e})),Object(m.a)((function(){return e.res.revertTemplate(a).pipe(Object(w.a)((function(){e.updatedStore.delete(a),e.removeUpdatedStore.add(a)})))})))})),Object(v.a)(1)).subscribe((function(t){var a=t.email;e.ngb.Email=a}))}},{key:"ngOnInit",value:function(){this.keyDowns$.subscribe()}},{key:"ngOnDestroy",value:function(){this.onDestroy$.next(!0),this.onDestroy$.complete(),this.activeLanguage$.complete(),this.previewTemplate$.complete(),this.editTemplateObject$.complete(),this.updatedStore.clear(),this.removeUpdatedStore.clear()}}]),e}()).\u0275fac=function(e){return new(e||$e)(k.Kb(x),k.Kb(P.d),k.Kb(A.b),k.Kb(k.j))},$e.\u0275cmp=k.Eb({type:$e,selectors:[["ng-component"]],viewQuery:function(e,t){var a;1&e&&k.Gc(ie,!0),2&e&&k.nc(a=k.Zb())&&(t.sidenav=a.first)},decls:28,vars:21,consts:[[2,"width","100%",3,"backdropClick"],["fxLayout","column wrap","fxLayoutAlign","top center","fxLayoutGap","1rem",1,"mat-typography"],[1,"mat-elevation-z2"],["mode","indeterminate","style","position: absolute;",4,"ngIf"],["fxLayout","","fxLayoutGap","1rem",2,"margin-left","auto"],["mat-flat-button","","color","primary","class","capitalize",4,"ngIf"],["mat-flat-button","",3,"matMenuTriggerFor","disabled"],["langMenu","matMenu"],[4,"ngIf"],[2,"padding","1rem","max-width","1400px","width","100%","box-sizing","border-box"],["fxFlex",""],[3,"expanded","opened",4,"ngFor","ngForOf"],["position","end","disableClose","",2,"width","1200px","max-width","80%"],["sidenav",""],["mode","indeterminate",2,"position","absolute"],["mat-flat-button","","color","primary",1,"capitalize"],["matMenuContent",""],[4,"ngFor","ngForOf"],["mat-menu-item","",1,"capitalize",3,"click"],[3,"expanded","opened"],[1,"capitalize"],["fxFlex","",3,"dataSource"],["matColumnDef","active"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","name"],["matColumnDef","subject"],["class","subject-column","fxLayoutAlign","space-between center",4,"matCellDef"],["matColumnDef","actions"],["fxFlex","0 0 144px","fxLayoutAlign","flex-end center",4,"matHeaderCellDef"],["fxLayoutAlign","flex-end","fxFlex","0 0 auto",4,"matCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["matTooltip","Change active status","matTooltipPosition","above","disableRipple","",3,"checked","disabled","change"],["fxLayoutAlign","space-between center",1,"subject-column"],["fxLayout","","fxLayoutAlign","center center","fxLayoutGap","0.5rem"],["matTooltip","Last updated","matTooltipPosition","above"],["mat-icon-button","","matTooltip","Edit email details","matTooltipPosition","left","aria-label","Edit email details","color","primary",3,"disabled","click"],["fxFlex","0 0 144px","fxLayoutAlign","flex-end center"],["fxLayoutAlign","flex-end","fxFlex","0 0 auto"],["mat-icon-button","","matTooltip","Open on builder","matTooltipPosition","above","aria-label","Open on builder","color","accent",3,"disabled","click"],["mat-icon-button","","matTooltip","Preview","matTooltipPosition","above","aria-label","Preview","color","accent",3,"disabled","click"],["color","primary"],["mat-flat-button","","color","accent",2,"margin-left","auto",3,"click"],[2,"height","100%","justify-content","center",3,"template"],["fxLayoutGap","0.5rem",2,"margin-left","auto"],["mat-flat-button","","color","accent",3,"click"],[2,"height","inherit",3,"email"],["fxLayoutGap","0.5rem",1,"top-actions"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,t){if(1&e&&(k.Qb(0,"mat-sidenav-container",0),k.Yb("backdropClick",(function(){return t.backdropClick()})),k.Qb(1,"mat-sidenav-content"),k.Qb(2,"div",1),k.Qb(3,"mat-toolbar",2),k.Ac(4,ce,1,0,"mat-progress-bar",3),k.dc(5,"async"),k.Qb(6,"mat-toolbar-row"),k.Qb(7,"h1"),k.Cc(8,"Email templates"),k.Pb(),k.Qb(9,"div",4),k.Ac(10,oe,2,1,"button",5),k.dc(11,"async"),k.Qb(12,"button",6),k.dc(13,"async"),k.Cc(14," Other languages "),k.Pb(),k.Qb(15,"mat-menu",null,7),k.Ac(17,be,1,0,void 0,8),k.dc(18,"async"),k.Pb(),k.Pb(),k.Pb(),k.Pb(),k.Qb(19,"div",9),k.Qb(20,"mat-accordion",10),k.Ac(21,je,20,7,"mat-expansion-panel",11),k.dc(22,"keyvalue"),k.dc(23,"async"),k.Pb(),k.Pb(),k.Pb(),k.Pb(),k.Qb(24,"mat-sidenav",12,13),k.Ac(26,Te,3,2,"ng-container",8),k.dc(27,"async"),k.Pb(),k.Pb()),2&e){var a=k.oc(16);k.wb(4),k.ic("ngIf",k.ec(5,7,t.res.isLoading$)),k.wb(6),k.ic("ngIf",k.ec(11,9,t.getActiveLanguage$)),k.wb(2),k.ic("matMenuTriggerFor",a)("disabled",k.ec(13,11,t.res.isLoading$)),k.wb(5),k.ic("ngIf",k.ec(18,13,t.languages$)),k.wb(4),k.ic("ngForOf",k.ec(22,15,k.ec(23,17,t.getTemplates$))),k.wb(5),k.ic("ngIf",k.ec(27,19,t.sidenavDetails$))}},directives:[W.b,W.c,_.c,_.b,_.d,X.a,T.i,X.c,$.a,K.d,K.e,J.a,_.a,T.h,W.a,V.a,K.a,K.b,J.c,J.e,J.f,Z.j,Z.c,Z.e,Z.b,Z.g,Z.i,Z.d,Z.a,ee.a,te.a,ae.a,Z.f,Z.h,P.e,P.b],pipes:[T.a,T.e,ne,T.d],styles:["[_nghost-%COMP%]{display:block;height:inherit}[_nghost-%COMP%], mat-sidenav-container[_ngcontent-%COMP%]{min-height:inherit}mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:first-child{max-width:84px}mat-cell[_ngcontent-%COMP%]:first-child{max-width:-webkit-fit-content;max-width:-moz-fit-content;max-width:fit-content;padding-right:24px}mat-cell[_ngcontent-%COMP%]:nth-child(2), mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:nth-child(2){max-width:400px;border-right:1px solid #e0e0e0}mat-cell[_ngcontent-%COMP%]:nth-child(3), mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:nth-child(3){padding-left:24px}.subject-column[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{opacity:0;transition:all .3s ease-in-out;will-change:opacity}.subject-column[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:1}.subject-column[_ngcontent-%COMP%]:hover   button[_ngcontent-%COMP%]:not(:hover){opacity:.5}.mat-drawer-container[_ngcontent-%COMP%]{background:transparent;height:inherit}.force-select[_ngcontent-%COMP%]{-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all;margin-bottom:1rem}"],changeDetection:0}),$e)}}]);