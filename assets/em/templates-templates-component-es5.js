function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{BsGo:function(e,t,a){"use strict";a.r(t),a.d(t,"TemplatesComponent",(function(){return $e}));var n,i=a("mrSG"),c=a("XNiG"),o=a("2Vo4"),r=a("xgIS"),l=a("LRne"),s=a("EY2u"),b=a("Cfvw"),u=a("XqQ8"),m=a("lJxs"),d=a("1G5W"),p=a("vkgz"),f=a("JIr8"),g=a("IzEk"),h=a("nYR2"),v=a("z6cu"),w=a("UXun"),y=a("uSps"),P=a("fXoL"),O=a("tk/3"),C=a("dNgK"),x=((n=function(){function e(t,a){_classCallCheck(this,e),this.http=t,this.matSnack=a,this._isLoading$=new c.a,this.isLoading$=this._isLoading$.asObservable()}return _createClass(e,[{key:"httpRequest",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"get",i=arguments.length>3?arguments[3]:void 0;return this._isLoading$.next(!0),this.matSnack.open("Please wait..."),this.http.request(n,"".concat(globalThis.NGB.baseUrl,"/").concat(e),{params:a,body:i,responseType:"json"}).pipe(Object(f.a)((function(e){return e.error instanceof ErrorEvent?console.error("An error occurred:",e.error.message):(console.error("Backend returned code ".concat(e.status)),t.matSnack.open('Something bad happened; please try again later. "Error Status '.concat(e.status,'".'),"Close",{announcementMessage:"Something bad happened; please try again later."})),console.error(e),Object(v.a)(new Error("Something bad happened; please try again later."))})),Object(p.a)((function(){return t.matSnack.dismiss()})),Object(h.a)((function(){return t._isLoading$.next(!1)})))}},{key:"getTemplatesByLang",value:function(e){return this.httpRequest("templates",{language:e})}},{key:"getTemplateBody",value:function(e){return this.httpRequest("getEmailTemplate",{emailtemplateid:e})}},{key:"getTemplate",value:function(e){return this.httpRequest("getTemplate",{emailtemplateid:e}).pipe(Object(m.a)((function(e){return{isEdited:!!e.emailObject,email:new y.a(e.emailObject||{structures:[new y.f("cols_1",[[new y.g(e.message)]])]})}})))}},{key:"revertTemplate",value:function(e){return this.sendPostRequest(new FormData,"revertTemplate/".concat(e)).pipe(Object(m.a)((function(e){return{isEdited:!1,email:new y.a({structures:[new y.f("cols_1",[[new y.g(e.message)]])]})}})))}},{key:"getAllLanguages",value:function(){return this.httpRequest("languages").pipe(Object(w.a)(),Object(f.a)((function(){return Object(l.a)([])})))}},{key:"getAllMergeFields",value:function(e){return this.httpRequest("mergeFields",{type:e}).pipe(Object(f.a)((function(){return Object(l.a)([])})))}},{key:"sendPostRequest",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new FormData,t=arguments.length>1?arguments[1]:void 0,a=globalThis.NGB.token,n=a.token,i=a.name;return e.append(i,n),this.httpRequest(t,{},"post",e)}}]),e}()).\u0275fac=function(e){return new(e||n)(P.Ub(O.a),P.Ub(C.a))},n.\u0275prov=P.Gb({token:n,factory:n.\u0275fac,providedIn:"any"}),n),k=a("0IaG"),j=a("ofXK"),Q=a("XiUz"),$=a("bTqV"),T=a("3Pt+"),A=a("kmnG"),L=a("qFsG"),_=a("MutI"),D=a("f0Cb");function I(e,t){1&e&&(P.Ob(0),P.Qb(1,"h2",2),P.Cc(2,"Are you sure?"),P.Pb(),P.Qb(3,"mat-dialog-content"),P.Cc(4," You are about to close the builder, but there're unsaved changes, which will be lost. Are you sure? "),P.Pb(),P.Qb(5,"mat-dialog-actions",3),P.Qb(6,"button",4),P.Cc(7," No, Go back! "),P.Pb(),P.Qb(8,"button",5),P.Cc(9," Yes, Close it. "),P.Pb(),P.Pb(),P.Nb()),2&e&&(P.wb(8),P.ic("mat-dialog-close",!0))}function R(e,t){1&e&&(P.Ob(0),P.Qb(1,"h2",2),P.Cc(2,"Are you sure?"),P.Pb(),P.Qb(3,"mat-dialog-content"),P.Qb(4,"p"),P.Cc(5,"You are about to restore this template to default Perfex template, all additional changes will be lost."),P.Pb(),P.Qb(6,"p"),P.Qb(7,"strong"),P.Qb(8,"strong"),P.Cc(9,"This will affect only template body, not name nor subject."),P.Pb(),P.Pb(),P.Pb(),P.Qb(10,"p"),P.Qb(11,"strong"),P.Cc(12,"Are you sure?"),P.Pb(),P.Pb(),P.Pb(),P.Qb(13,"mat-dialog-actions",3),P.Qb(14,"button",4),P.Cc(15," No, Go back! "),P.Pb(),P.Qb(16,"button",5),P.Cc(17," Yes, Restore it. "),P.Pb(),P.Pb(),P.Nb()),2&e&&(P.wb(16),P.ic("mat-dialog-close",!0))}function F(e,t){if(1&e&&(P.Qb(0,"mat-list-item"),P.Qb(1,"div",16),P.Qb(2,"span"),P.Cc(3),P.Pb(),P.Qb(4,"code"),P.Cc(5),P.Pb(),P.Pb(),P.Pb()),2&e){var a=P.cc().$implicit;P.wb(3),P.Dc(a.name),P.wb(2),P.Dc(a.key)}}function E(e,t){1&e&&P.Lb(0,"mat-divider")}function M(e,t){if(1&e&&(P.Ob(0),P.Ac(1,F,6,2,"mat-list-item",1),P.Ac(2,E,1,0,"mat-divider",1),P.Nb()),2&e){var a=t.$implicit;P.wb(1),P.ic("ngIf",a.key),P.wb(1),P.ic("ngIf",a.key)}}function S(e,t){if(1&e&&(P.Qb(0,"mat-list",14),P.Ac(1,M,3,2,"ng-container",15),P.Pb()),2&e){var a=P.cc(2);P.wb(1),P.ic("ngForOf",a.data.mergeFields)}}function N(e,t){if(1&e&&(P.Ob(0),P.Qb(1,"h2",2),P.Cc(2,"Edit details"),P.Pb(),P.Qb(3,"mat-dialog-content"),P.Qb(4,"form",null,6),P.Lb(6,"input",7),P.Qb(7,"mat-form-field",8),P.Qb(8,"mat-label"),P.Cc(9,"From Name"),P.Pb(),P.Lb(10,"input",9),P.Pb(),P.Qb(11,"mat-form-field",8),P.Qb(12,"mat-label"),P.Cc(13,"Subject"),P.Pb(),P.Lb(14,"input",10),P.Pb(),P.Pb(),P.Ac(15,S,2,1,"mat-list",11),P.Pb(),P.Qb(16,"mat-dialog-actions",3),P.Qb(17,"button",12),P.Cc(18," Cancel "),P.Pb(),P.Qb(19,"button",13),P.Cc(20," Save "),P.Pb(),P.Pb(),P.Nb()),2&e){var a=P.oc(5),n=P.cc();P.wb(6),P.ic("value",n.data.data.emailtemplateid),P.wb(4),P.ic("value",n.data.data.fromname),P.wb(4),P.ic("value",n.data.data.subject),P.wb(1),P.ic("ngIf",n.data.mergeFields),P.wb(4),P.ic("disabled",!n.checkValidity(a))("mat-dialog-close",a)}}function Y(e,t){if(1&e&&(P.Ob(0),P.Qb(1,"h2",2),P.Cc(2,"Send test email"),P.Pb(),P.Qb(3,"mat-dialog-content"),P.Lb(4,"form",null,17),P.Pb(),P.Qb(6,"mat-dialog-actions",3),P.Qb(7,"button",4),P.Cc(8," No, Go back! "),P.Pb(),P.Qb(9,"button",5),P.Cc(10," Yes, Close it. "),P.Pb(),P.Pb(),P.Nb()),2&e){var a=P.oc(5);P.wb(9),P.ic("mat-dialog-close",a)}}var G,q,B=((G=function(){function e(t){_classCallCheck(this,e),this.data=t}return _createClass(e,[{key:"checkValidity",value:function(e){return e.checkValidity()}}]),e}()).\u0275fac=function(e){return new(e||G)(P.Kb(k.a))},G.\u0275cmp=P.Eb({type:G,selectors:[["app-modal-dialog"]],decls:5,vars:4,consts:[[1,"mat-typography"],[4,"ngIf"],["mat-dialog-title",""],["fxLayoutAlign","space-between center"],["mat-button","","color","warn","cdkFocusInitial","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["form",""],["type","hidden","name","emailtemplateid",3,"value"],["appearance","fill"],["matInput","","name","fromname","required","","type","text",3,"value"],["matInput","","name","subject","required","","type","text",3,"value"],["dense","",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary","cdkFocusInitial","",3,"disabled","mat-dialog-close"],["dense",""],[4,"ngFor","ngForOf"],["fxFlex","","fxLayout","","fxLayoutAlign","space-between center"],["form","ngForm"]],template:function(e,t){1&e&&(P.Qb(0,"div",0),P.Ac(1,I,10,1,"ng-container",1),P.Ac(2,R,18,1,"ng-container",1),P.Ac(3,N,21,6,"ng-container",1),P.Ac(4,Y,11,1,"ng-container",1),P.Pb()),2&e&&(P.wb(1),P.ic("ngIf","confirm"===t.data.type),P.wb(1),P.ic("ngIf","confirm-revert"===t.data.type),P.wb(1),P.ic("ngIf","edit"===t.data.type),P.wb(1),P.ic("ngIf","test-email"===t.data.type))},directives:[j.i,k.h,k.e,k.c,Q.b,$.a,k.d,T.n,T.i,T.j,A.b,A.f,L.a,_.a,j.h,_.c,Q.a,Q.c,D.a],styles:["[_nghost-%COMP%]{display:block}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;height:auto}mat-list[_ngcontent-%COMP%]{max-height:300px;overflow:auto}mat-list[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all}"]}),G),z=a("XhcP"),V=a("/t3+"),K=a("STbY"),X=a("7EHt"),J=a("bv9b"),U=a("+0xr"),H=a("1jcm"),W=a("Qu3c"),Z=a("NFeN"),ee=((q=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e){return e.split("_").join(" ")}}]),e}()).\u0275fac=function(e){return new(e||q)},q.\u0275pipe=P.Jb({name:"keyToLang",type:q,pure:!0}),q),te=["sidenav"];function ae(e,t){1&e&&P.Lb(0,"mat-progress-bar",15)}function ne(e,t){if(1&e&&(P.Qb(0,"button",16),P.Cc(1),P.Pb()),2&e){var a=t.ngIf;P.wb(1),P.Ec(" ",a," ")}}function ie(e,t){if(1&e){var a=P.Rb();P.Ob(0),P.Qb(1,"button",18),P.Yb("click",(function(){P.rc(a);var e=t.$implicit;return P.cc(2).changeLanguage(e)})),P.Cc(2),P.dc(3,"keyToLang"),P.Pb(),P.Nb()}if(2&e){var n=t.$implicit;P.wb(2),P.Ec(" ",P.ec(3,1,n)," ")}}function ce(e,t){if(1&e&&(P.Ac(0,ie,4,3,"ng-container",17),P.dc(1,"async")),2&e){var a=P.cc();P.ic("ngForOf",P.ec(1,1,a.languages$))}}function oe(e,t){1&e&&P.Lb(0,"mat-header-cell")}function re(e,t){if(1&e){var a=P.Rb();P.Qb(0,"mat-cell"),P.Qb(1,"mat-slide-toggle",33),P.Yb("change",(function(e){P.rc(a);var n=t.$implicit;return P.cc(2).changeActiveStatus(e,n)})),P.dc(2,"async"),P.Pb(),P.Pb()}if(2&e){var n=t.$implicit,i=P.cc(2);P.wb(1),P.ic("checked",n.active-0==1)("disabled",P.ec(2,2,i.res.isLoading$))}}function le(e,t){1&e&&(P.Qb(0,"mat-header-cell"),P.Cc(1,"Name"),P.Pb())}function se(e,t){if(1&e&&(P.Qb(0,"span"),P.Cc(1),P.Pb()),2&e){var a=P.cc().$implicit;P.wb(1),P.Dc(a.name)}}function be(e,t){if(1&e&&(P.Qb(0,"del"),P.Cc(1),P.Pb()),2&e){var a=P.cc().$implicit;P.wb(1),P.Dc(a.name)}}function ue(e,t){if(1&e&&(P.Qb(0,"mat-cell"),P.Ac(1,se,2,1,"span",14),P.Ac(2,be,2,1,"del",14),P.Pb()),2&e){var a=t.$implicit;P.wb(1),P.ic("ngIf","1"===a.active),P.wb(1),P.ic("ngIf","1"!==a.active)}}function me(e,t){1&e&&(P.Qb(0,"mat-header-cell"),P.Cc(1," From Name > Subject "),P.Pb())}function de(e,t){if(1&e&&(P.Qb(0,"span"),P.Cc(1),P.Pb()),2&e){var a=P.cc().$implicit;P.wb(1),P.Ec(" ",a.fromname," > ")}}function pe(e,t){if(1&e&&(P.Qb(0,"span"),P.Cc(1),P.dc(2,"date"),P.Pb()),2&e){var a=P.cc().$implicit;P.wb(1),P.Dc(P.fc(2,1,a.updated_at,"short"))}}function fe(e,t){1&e&&(P.Qb(0,"span"),P.Cc(1,"-"),P.Pb())}function ge(e,t){if(1&e){var a=P.Rb();P.Qb(0,"mat-cell",34),P.Qb(1,"div"),P.Ac(2,de,2,1,"span",14),P.Cc(3),P.Pb(),P.Qb(4,"div",35),P.Qb(5,"span",36),P.Ac(6,pe,3,4,"span",14),P.Ac(7,fe,2,0,"span",14),P.Pb(),P.Qb(8,"button",37),P.Yb("click",(function(){P.rc(a);var e=t.$implicit,n=P.cc().$implicit;return P.cc().changeElementDetails(e,n.key)})),P.dc(9,"async"),P.Qb(10,"mat-icon"),P.Cc(11,"edit"),P.Pb(),P.Pb(),P.Pb(),P.Pb()}if(2&e){var n=t.$implicit,i=P.cc(2);P.wb(2),P.ic("ngIf",n.fromname),P.wb(1),P.Ec(" ",n.subject," "),P.wb(3),P.ic("ngIf",n.updated_at),P.wb(1),P.ic("ngIf",!n.updated_at),P.wb(1),P.ic("disabled",P.ec(9,5,i.res.isLoading$))}}function he(e,t){1&e&&(P.Qb(0,"mat-header-cell",38),P.Cc(1," Actions "),P.Pb())}function ve(e,t){1&e&&(P.Qb(0,"mat-icon"),P.Cc(1," visibility "),P.Pb())}function we(e,t){1&e&&(P.Qb(0,"mat-icon"),P.Cc(1," visibility_off "),P.Pb())}function ye(e,t){if(1&e){var a=P.Rb();P.Qb(0,"mat-cell",39),P.Qb(1,"button",40),P.Yb("click",(function(){P.rc(a);var e=t.$implicit,n=P.cc().$implicit;return P.cc().editTemplate(e,n.key)})),P.dc(2,"async"),P.Qb(3,"mat-icon"),P.Cc(4,"dashboard"),P.Pb(),P.Pb(),P.Qb(5,"button",41),P.Yb("click",(function(){P.rc(a);var e=t.$implicit,n=P.cc().$implicit;return P.cc().previewTemplate(e,n.key)})),P.dc(6,"async"),P.Ac(7,ve,2,0,"mat-icon",14),P.Ac(8,we,2,0,"mat-icon",14),P.Pb(),P.Pb()}if(2&e){var n=t.$implicit,i=P.cc(2);P.wb(1),P.ic("disabled",P.ec(2,4,i.res.isLoading$)),P.wb(4),P.ic("disabled",P.ec(6,6,i.res.isLoading$)),P.wb(2),P.ic("ngIf",n.active-0==1),P.wb(1),P.ic("ngIf",n.active-0==0)}}function Pe(e,t){1&e&&P.Lb(0,"mat-header-row")}function Oe(e,t){1&e&&P.Lb(0,"mat-row")}function Ce(e,t){if(1&e){var a=P.Rb();P.Qb(0,"mat-expansion-panel",19),P.Yb("opened",(function(){P.rc(a);var e=t.$implicit;return P.cc().expansionPanelOpen(e.key)})),P.Qb(1,"mat-expansion-panel-header"),P.Qb(2,"mat-panel-title",20),P.Cc(3),P.dc(4,"keyToLang"),P.Pb(),P.Pb(),P.Qb(5,"mat-table",21),P.Ob(6,22),P.Ac(7,oe,1,0,"mat-header-cell",23),P.Ac(8,re,3,4,"mat-cell",24),P.Nb(),P.Ob(9,25),P.Ac(10,le,2,0,"mat-header-cell",23),P.Ac(11,ue,3,2,"mat-cell",24),P.Nb(),P.Ob(12,26),P.Ac(13,me,2,0,"mat-header-cell",23),P.Ac(14,ge,12,7,"mat-cell",27),P.Nb(),P.Ob(15,28),P.Ac(16,he,2,0,"mat-header-cell",29),P.Ac(17,ye,9,8,"mat-cell",30),P.Nb(),P.Ac(18,Pe,1,0,"mat-header-row",31),P.Ac(19,Oe,1,0,"mat-row",32),P.Pb(),P.Pb()}if(2&e){var n=t.$implicit,i=P.cc();P.ic("expanded",n.key===i.expansionPanelOpen()),P.wb(3),P.Ec(" ",P.ec(4,5,n.key)," "),P.wb(2),P.ic("dataSource",n.value),P.wb(13),P.ic("matHeaderRowDef",i.displayedColumns),P.wb(1),P.ic("matRowDefColumns",i.displayedColumns)}}function xe(e,t){1&e&&(P.Qb(0,"span"),P.Cc(1,"\xa0[Unedited]"),P.Pb())}function ke(e,t){if(1&e){var a=P.Rb();P.Ob(0),P.Qb(1,"mat-toolbar",42),P.Qb(2,"mat-toolbar-row"),P.Qb(3,"span"),P.Cc(4),P.Pb(),P.Ac(5,xe,2,0,"span",14),P.Qb(6,"button",43),P.Yb("click",(function(){P.rc(a);var e=t.ngIf;return P.cc().openBuilderFromPreview(e)})),P.Cc(7," Edit it on builder "),P.Pb(),P.Pb(),P.Pb(),P.Lb(8,"ip-preview-template",44),P.Nb()}if(2&e){var n=t.ngIf;P.wb(4),P.Dc(n.name),P.wb(1),P.ic("ngIf",!n.is_edited),P.wb(3),P.ic("template",n.html)}}function je(e,t){if(1&e){var a=P.Rb();P.Ob(0),P.Qb(1,"mat-toolbar",42),P.Qb(2,"mat-toolbar-row"),P.Qb(3,"span"),P.Cc(4),P.Pb(),P.Qb(5,"div",45),P.Qb(6,"button",46),P.Yb("click",(function(){P.rc(a);var e=t.ngIf;return P.cc().saveEmail(e)})),P.Cc(7," Save "),P.Pb(),P.Qb(8,"button",46),P.Yb("click",(function(){P.rc(a);var e=t.ngIf;return P.cc().saveEmail(e,!0)})),P.Cc(9," Save and Close "),P.Pb(),P.Pb(),P.Pb(),P.Pb(),P.Qb(10,"ip-email-builder",47),P.Qb(11,"div",48),P.Qb(12,"button",46),P.Yb("click",(function(){P.rc(a);var e=t.ngIf;return P.cc().revertTemplateBack(e.isEdited)})),P.Cc(13," Restore template "),P.Pb(),P.Pb(),P.Pb(),P.Nb()}if(2&e){var n=t.ngIf;P.wb(4),P.Dc(n.name),P.wb(6),P.ic("email",n.email)}}var Qe,$e=((Qe=function(){function e(t,a,n,i){var s=this;_classCallCheck(this,e),this.res=t,this.ngb=a,this.dialog=n,this.el=i,this.onDestroy$=new c.a,this.activeLanguage$=new o.a(null),this.previewTemplate$=new o.a(null),this.editTemplateObject$=new o.a(null),this.displayedColumns=["active","name","subject","actions"],this.languages$=this.res.getAllLanguages().pipe(Object(u.a)((function(e){return s.getActiveLanguage$.pipe(Object(m.a)((function(t){return e.filter((function(e){return![t].includes(e)}))})))})),Object(d.a)(this.onDestroy$)),this.getActiveLanguage$=this.activeLanguage$.pipe(Object(m.a)((function(e){return e||globalThis.NGB.activeLanguage})),Object(d.a)(this.onDestroy$)),this.keyDowns$=Object(r.a)(this.el.nativeElement,"keydown").pipe(Object(p.a)((function(e){s.sidenav.opened&&e.stopImmediatePropagation()})),Object(d.a)(this.onDestroy$)),this.getTemplates$=this.getActiveLanguage$.pipe(Object(u.a)((function(e){return s.res.getTemplatesByLang(e)})),Object(d.a)(this.onDestroy$)),this.getTemplateObject$=this.editTemplateObject$.pipe(Object(u.a)((function(e){return e?e.email?Object(l.a)(e):s.res.getTemplate(e.emailtemplateid).pipe(Object(m.a)((function(t){return Object.assign(Object.assign({},e),t)}))):Object(l.a)(null)})),Object(u.a)((function(e){return e?s.res.getAllMergeFields(e.type).pipe(Object(p.a)((function(e){s.ngb.MergeTags=new Set(e.map((function(e){return e.key})))})),Object(m.a)((function(){return e})),Object(p.a)((function(){s.previewTemplate$.next(null),s.sidenav.open()}))):Object(l.a)(null)})),Object(d.a)(this.onDestroy$)),this.getPreviewTemplate$=this.previewTemplate$.pipe(Object(u.a)((function(e){return e&&s.res.getTemplateBody(e.id).pipe(Object(m.a)((function(t){return Object.assign(Object.assign({},t),e)})),Object(p.a)((function(e){e&&(s.editTemplateObject$.next(null),s.sidenav.open())})))||Object(l.a)(null)})),Object(d.a)(this.onDestroy$))}return _createClass(e,[{key:"changeLanguage",value:function(e){this.activeLanguage$.next(e)}},{key:"editTemplate",value:function(e,t){this.editTemplateObject$.next({emailtemplateid:e.emailtemplateid,type:t,name:e.name})}},{key:"previewTemplate",value:function(e){this.previewTemplate$.next({id:e.emailtemplateid,name:e.name})}},{key:"closeSidenav",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=!0,t.t0=e&&this.ngb.hasChanges&&this.editTemplateObject$.getValue(),!t.t0){t.next=6;break}return t.next=5,this.dialog.open(B,{data:{type:"confirm"},width:"300px",maxWidth:"100%"}).afterClosed().pipe(Object(m.a)(Boolean)).toPromise();case 5:a=t.sent;case 6:if(t.t1=a,!t.t1){t.next=11;break}return t.next=10,this.sidenav.close();case 10:this.editTemplateObject$.next(null);case 11:this.previewTemplate$.next(null);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"openBuilderFromPreview",value:function(e){var t=e.id,a=e.type,n=e.name;return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.previewTemplate$.next(null),e.next=3,this.closeSidenav();case 3:this.editTemplateObject$.next({emailtemplateid:t,type:a,name:n});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"expansionPanelOpen",value:function(e){return e&&localStorage.setItem("expansionPanelOpened",e),localStorage.getItem("expansionPanelOpened")||"client"}},{key:"saveEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark((function a(){var n,i,c=this;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!this.ngb.hasChanges){a.next=5;break}n=new FormData,i=this.editTemplateObject$.getValue(),n.append("emailtemplateid",i.emailtemplateid),this.ngb.saveEmail().pipe(Object(u.a)((function(e){var t=e.html;return n.append("emailObject",JSON.stringify(c.ngb.Email)),n.append("template",t),c.res.sendPostRequest(n,"update")})),Object(f.a)((function(e){return console.error(e),c.ngb.notify("Something bad happened."),s.a})),Object(g.a)(1)).subscribe((function(a){a.success&&(e.isEdited=!0,i.updated_at=new Date,t?Object(b.a)(c.closeSidenav()).pipe(Object(h.a)((function(){return c.ngb.notify("Email template has been saved successfully.")}))):c.ngb.notify("Email template has been saved successfully."))})),a.next=10;break;case 5:if(a.t0=t,!a.t0){a.next=9;break}return a.next=9,this.closeSidenav();case 9:this.ngb.notify("Email template has been saved successfully.");case 10:case"end":return a.stop()}}),a,this)})))}},{key:"changeActiveStatus",value:function(e,t){var a=e.checked,n=e.source;return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a?1:0,(c=new FormData).append("emailtemplateid",t.emailtemplateid),c.append("active",String(i)),e.prev=2,e.next=5,this.res.sendPostRequest(c,"changeActiveStatus").toPromise();case 5:if(!e.sent.success){e.next=9;break}t.active=i,t.updated_at=new Date,e.next=10;break;case 9:n.toggle();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.toggle();case 15:case"end":return e.stop()}}),e,this,[[2,12]])})))}},{key:"changeElementDetails",value:function(e){return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.dialog.open(B,{data:{type:"edit",data:e,mergeFields:[]},width:"450px",maxWidth:"100%"}).afterClosed().pipe(Object(u.a)((function(e){if(!e)return Object(l.a)({success:!1});var t=new FormData(e);return n.res.sendPostRequest(t,"updateDetails")}))).toPromise();case 2:(a=t.sent).success&&(e.subject=a.updates.subject,e.fromname=a.updates.fromname,e.updated_at=new Date,this.ngb.notify("The details have been saved."));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"revertTemplateBack",value:function(e){var t=this;if(e){var a=this.editTemplateObject$.getValue();this.dialog.open(B,{data:{type:"confirm-revert"},width:"300px",maxWidth:"100%"}).afterClosed().pipe(Object(m.a)(Boolean),Object(u.a)((function(e){return e&&t.res.revertTemplate(a.emailtemplateid)||s.a})),Object(p.a)((function(e){return t.ngb.Email=e.email})),Object(p.a)((function(){return delete a.updated_at})),Object(g.a)(1)).toPromise()}else this.ngb.notify("You can't restore this template, as it's not edited.")}},{key:"ngOnInit",value:function(){this.keyDowns$.subscribe()}},{key:"ngOnDestroy",value:function(){this.onDestroy$.next(!0),this.onDestroy$.complete(),this.activeLanguage$.complete(),this.previewTemplate$.complete(),this.editTemplateObject$.complete()}}]),e}()).\u0275fac=function(e){return new(e||Qe)(P.Kb(x),P.Kb(y.d),P.Kb(k.b),P.Kb(P.j))},Qe.\u0275cmp=P.Eb({type:Qe,selectors:[["ng-component"]],viewQuery:function(e,t){var a;1&e&&P.Gc(te,!0),2&e&&P.nc(a=P.Zb())&&(t.sidenav=a.first)},decls:29,vars:21,consts:[[2,"width","100%",3,"backdropClick"],["fxLayout","column wrap","fxLayoutAlign","top center","fxLayoutGap","1rem",1,"mat-typography"],[1,"mat-elevation-z2"],["mode","indeterminate","style","position: absolute;",4,"ngIf"],["fxLayout","","fxLayoutGap","1rem",2,"margin-left","auto"],["mat-flat-button","","color","primary","class","capitalize",4,"ngIf"],["mat-flat-button","",3,"matMenuTriggerFor","disabled"],["langMenu","matMenu"],["matMenuContent",""],[2,"padding","1rem","max-width","1400px","width","100%","box-sizing","border-box"],["fxFlex",""],[3,"expanded","opened",4,"ngFor","ngForOf"],["position","end","disableClose","",2,"width","1200px","max-width","80%"],["sidenav",""],[4,"ngIf"],["mode","indeterminate",2,"position","absolute"],["mat-flat-button","","color","primary",1,"capitalize"],[4,"ngFor","ngForOf"],["mat-menu-item","",1,"capitalize",3,"click"],[3,"expanded","opened"],[1,"capitalize"],["fxFlex","",3,"dataSource"],["matColumnDef","active"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","name"],["matColumnDef","subject"],["class","subject-column","fxLayoutAlign","space-between center",4,"matCellDef"],["matColumnDef","actions"],["fxFlex","0 0 144px","fxLayoutAlign","flex-end center",4,"matHeaderCellDef"],["fxLayoutAlign","flex-end","fxFlex","0 0 auto",4,"matCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["matTooltip","Change active status","matTooltipPosition","above","disableRipple","",3,"checked","disabled","change"],["fxLayoutAlign","space-between center",1,"subject-column"],["fxLayout","","fxLayoutAlign","center center","fxLayoutGap","0.5rem"],["matTooltip","Last updated","matTooltipPosition","above"],["mat-icon-button","","matTooltip","Edit email details","matTooltipPosition","left","aria-label","Edit email details","color","primary",3,"disabled","click"],["fxFlex","0 0 144px","fxLayoutAlign","flex-end center"],["fxLayoutAlign","flex-end","fxFlex","0 0 auto"],["mat-icon-button","","matTooltip","Open on builder","matTooltipPosition","above","aria-label","Open on builder","color","accent",3,"disabled","click"],["mat-icon-button","","matTooltip","Preview","matTooltipPosition","above","aria-label","Preview","color","accent",3,"disabled","click"],["color","primary"],["mat-flat-button","","color","accent",2,"margin-left","auto",3,"click"],[2,"height","100%","justify-content","center",3,"template"],["fxLayoutGap","0.5rem",2,"margin-left","auto"],["mat-flat-button","","color","accent",3,"click"],[2,"height","inherit",3,"email"],[1,"top-actions"]],template:function(e,t){if(1&e&&(P.Qb(0,"mat-sidenav-container",0),P.Yb("backdropClick",(function(){return t.closeSidenav()})),P.Qb(1,"mat-sidenav-content"),P.Qb(2,"div",1),P.Qb(3,"mat-toolbar",2),P.Ac(4,ae,1,0,"mat-progress-bar",3),P.dc(5,"async"),P.Qb(6,"mat-toolbar-row"),P.Qb(7,"h1"),P.Cc(8,"Email templates"),P.Pb(),P.Qb(9,"div",4),P.Ac(10,ne,2,1,"button",5),P.dc(11,"async"),P.Qb(12,"button",6),P.dc(13,"async"),P.Cc(14," Other languages "),P.Pb(),P.Qb(15,"mat-menu",null,7),P.Ac(17,ce,2,3,"ng-template",8),P.Pb(),P.Pb(),P.Pb(),P.Pb(),P.Qb(18,"div",9),P.Qb(19,"mat-accordion",10),P.Ac(20,Ce,20,7,"mat-expansion-panel",11),P.dc(21,"keyvalue"),P.dc(22,"async"),P.Pb(),P.Pb(),P.Pb(),P.Pb(),P.Qb(23,"mat-sidenav",12,13),P.Ac(25,ke,9,3,"ng-container",14),P.dc(26,"async"),P.Ac(27,je,14,2,"ng-container",14),P.dc(28,"async"),P.Pb(),P.Pb()),2&e){var a=P.oc(16);P.wb(4),P.ic("ngIf",P.ec(5,7,t.res.isLoading$)),P.wb(6),P.ic("ngIf",P.ec(11,9,t.getActiveLanguage$)),P.wb(2),P.ic("matMenuTriggerFor",a)("disabled",P.ec(13,11,t.res.isLoading$)),P.wb(8),P.ic("ngForOf",P.ec(21,13,P.ec(22,15,t.getTemplates$))),P.wb(5),P.ic("ngIf",P.ec(26,17,t.getPreviewTemplate$)),P.wb(2),P.ic("ngIf",P.ec(28,19,t.getTemplateObject$))}},directives:[z.b,z.c,Q.c,Q.b,Q.d,V.a,j.i,V.c,$.a,K.d,K.e,K.a,X.a,Q.a,j.h,z.a,J.a,K.b,X.c,X.e,X.f,U.j,U.c,U.e,U.b,U.g,U.i,U.d,U.a,H.a,W.a,Z.a,U.f,U.h,y.e,y.b],pipes:[j.a,j.e,ee,j.d],styles:["[_nghost-%COMP%]{display:block;height:inherit}[_nghost-%COMP%], mat-sidenav-container[_ngcontent-%COMP%]{min-height:inherit}mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:first-child{max-width:84px}mat-cell[_ngcontent-%COMP%]:first-child{max-width:-webkit-fit-content;max-width:-moz-fit-content;max-width:fit-content;padding-right:24px}mat-cell[_ngcontent-%COMP%]:nth-child(2), mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:nth-child(2){max-width:400px;border-right:1px solid #e0e0e0}mat-cell[_ngcontent-%COMP%]:nth-child(3), mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:nth-child(3){padding-left:24px}.subject-column[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{opacity:0;transition:all .3s ease-in-out;will-change:opacity}.subject-column[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:1}.subject-column[_ngcontent-%COMP%]:hover   button[_ngcontent-%COMP%]:not(:hover){opacity:.5}.mat-drawer-container[_ngcontent-%COMP%]{background:transparent;height:inherit}.force-select[_ngcontent-%COMP%]{-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all;margin-bottom:1rem}"],changeDetection:0}),Qe)}}]);