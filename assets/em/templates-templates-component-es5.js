function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],a=!0,i=!1,c=void 0;try{for(var r,o=e[Symbol.iterator]();!(a=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(l){i=!0,c=l}finally{try{a||null==o.return||o.return()}finally{if(i)throw c}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,a=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{BsGo:function(e,t,n){"use strict";n.r(t),n.d(t,"TemplatesComponent",(function(){return Ee}));var a=n("XNiG"),i=n("2Vo4"),c=n("xgIS"),r=n("eNwd"),o=n("LRne"),l=n("cp0P"),s=n("itXk"),u=n("EY2u"),b=n("pLZG"),d=n("XqQ8"),p=n("lJxs"),m=n("vkgz"),f=n("1G5W"),g=n("HDdC"),h=n("7Hc7"),v=n("Y7HM"),y=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.a;return _classCallCheck(this,n),(a=t.call(this)).source=e,a.delayTime=i,a.scheduler=c,(!Object(v.a)(i)||i<0)&&(a.delayTime=0),c&&"function"==typeof c.schedule||(a.scheduler=h.a),a}return _createClass(n,[{key:"_subscribe",value:function(e){return this.scheduler.schedule(n.dispatch,this.delayTime,{source:this.source,subscriber:e})}}],[{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.a;return new n(e,t,a)}},{key:"dispatch",value:function(e){var t=e.source,n=e.subscriber;return this.add(t.subscribe(n))}}]),n}(g.a);function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(n){return n.lift(new O(e,t))}}var P,O=function(){function e(t,n){_classCallCheck(this,e),this.scheduler=t,this.delay=n}return _createClass(e,[{key:"call",value:function(e,t){return new y(t,this.delay,this.scheduler).subscribe(e)}}]),e}(),C=n("eIep"),k=n("IzEk"),j=n("JIr8"),_=n("nYR2"),x=n("uSps"),Q=n("z6cu"),T=n("UXun"),A=n("fXoL"),$=n("tk/3"),L=n("dNgK"),I=((P=function(){function e(t,n){_classCallCheck(this,e),this.http=t,this.matSnack=n,this._isLoading$=new a.a,this.isLoading$=this._isLoading$.asObservable()}return _createClass(e,[{key:"httpRequest",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"get",i=arguments.length>3?arguments[3]:void 0;return this._isLoading$.next(!0),this.matSnack.open("Please wait..."),this.http.request(a,"".concat(globalThis.NGB.baseUrl,"/").concat(e),{params:n,body:i,responseType:"json"}).pipe(Object(j.a)((function(e){return e.error instanceof ErrorEvent?console.error("An error occurred:",e.error.message):(console.error("Backend returned code ".concat(e.status)),t.matSnack.open('Something bad happened; please try again later. "Error Status '.concat(e.status,'".'),"Close",{announcementMessage:"Something bad happened; please try again later."})),console.error(e),Object(Q.a)(new Error("Something bad happened; please try again later."))})),Object(m.a)((function(){return t.matSnack.dismiss()})),Object(_.a)((function(){return t._isLoading$.next(!1)})))}},{key:"getTemplatesByLang",value:function(e){return this.httpRequest("templates",{language:e})}},{key:"getTemplateBody",value:function(e){return this.httpRequest("getEmailTemplate",{id:e})}},{key:"getTemplate",value:function(e){return this.httpRequest("getTemplate",{id:e})}},{key:"revertTemplate",value:function(e){return this.sendPostRequest(new FormData,"revertTemplate/".concat(e)).pipe(Object(p.a)((function(e){return{isEdited:!1,email:new x.a({structures:[new x.f("cols_1",[[new x.g(e.message)]])]})}})))}},{key:"getAllLanguages",value:function(){return this.httpRequest("languages").pipe(Object(T.a)(),Object(j.a)((function(){return Object(o.a)([])})))}},{key:"getAllMergeFields",value:function(e){return this.httpRequest("mergeFields",{type:e}).pipe(Object(j.a)((function(){return Object(o.a)([])})))}},{key:"sendPostRequest",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new FormData,t=arguments.length>1?arguments[1]:void 0,n=globalThis.NGB.csrf,a=n.token,i=n.name;return e.append(i,a),this.httpRequest(t,{},"post",e)}}]),e}()).\u0275fac=function(e){return new(e||P)(A.Ub($.b),A.Ub(L.a))},P.\u0275prov=A.Gb({token:P,factory:P.\u0275fac,providedIn:"any"}),P),S=n("0IaG"),D=n("ofXK"),F=n("XiUz"),M=n("bTqV"),R=n("3Pt+"),E=n("kmnG"),N=n("qFsG"),G=n("MutI"),Y=n("f0Cb");function B(e,t){1&e&&(A.Ob(0),A.Qb(1,"h2",2),A.Cc(2,"Are you sure?"),A.Pb(),A.Qb(3,"mat-dialog-content"),A.Cc(4," You are about to close the builder, but there're unsaved changes, which will be lost. Are you sure? "),A.Pb(),A.Qb(5,"mat-dialog-actions",3),A.Qb(6,"button",4),A.Cc(7," No, Go back! "),A.Pb(),A.Qb(8,"button",5),A.Cc(9," Yes, Close it. "),A.Pb(),A.Pb(),A.Nb()),2&e&&(A.wb(8),A.ic("mat-dialog-close",!0))}function q(e,t){1&e&&(A.Ob(0),A.Qb(1,"h2",2),A.Cc(2,"Are you sure?"),A.Pb(),A.Qb(3,"mat-dialog-content"),A.Qb(4,"p"),A.Cc(5,"You are about to restore this template to default Perfex template, all additional changes will be lost."),A.Pb(),A.Qb(6,"p"),A.Qb(7,"strong"),A.Qb(8,"strong"),A.Cc(9,"This will affect only template body, not name nor subject."),A.Pb(),A.Pb(),A.Pb(),A.Qb(10,"p"),A.Qb(11,"strong"),A.Cc(12,"Are you sure?"),A.Pb(),A.Pb(),A.Pb(),A.Qb(13,"mat-dialog-actions",3),A.Qb(14,"button",4),A.Cc(15," No, Go back! "),A.Pb(),A.Qb(16,"button",5),A.Cc(17," Yes, Restore it. "),A.Pb(),A.Pb(),A.Nb()),2&e&&(A.wb(16),A.ic("mat-dialog-close",!0))}function U(e,t){if(1&e&&(A.Qb(0,"mat-list-item"),A.Qb(1,"div",16),A.Qb(2,"span"),A.Cc(3),A.Pb(),A.Qb(4,"code"),A.Cc(5),A.Pb(),A.Pb(),A.Pb()),2&e){var n=A.cc().$implicit;A.wb(3),A.Dc(n.name),A.wb(2),A.Dc(n.key)}}function z(e,t){1&e&&A.Lb(0,"mat-divider")}function H(e,t){if(1&e&&(A.Ob(0),A.Ac(1,U,6,2,"mat-list-item",1),A.Ac(2,z,1,0,"mat-divider",1),A.Nb()),2&e){var n=t.$implicit;A.wb(1),A.ic("ngIf",n.key),A.wb(1),A.ic("ngIf",n.key)}}function K(e,t){if(1&e&&(A.Qb(0,"mat-list",14),A.Ac(1,H,3,2,"ng-container",15),A.Pb()),2&e){var n=A.cc(2);A.wb(1),A.ic("ngForOf",n.data.mergeFields)}}function W(e,t){if(1&e&&(A.Ob(0),A.Qb(1,"h2",2),A.Cc(2,"Edit details"),A.Pb(),A.Qb(3,"mat-dialog-content"),A.Qb(4,"form",null,6),A.Lb(6,"input",7),A.Qb(7,"mat-form-field",8),A.Qb(8,"mat-label"),A.Cc(9,"From Name"),A.Pb(),A.Lb(10,"input",9),A.Pb(),A.Qb(11,"mat-form-field",8),A.Qb(12,"mat-label"),A.Cc(13,"Subject"),A.Pb(),A.Lb(14,"input",10),A.Pb(),A.Pb(),A.Ac(15,K,2,1,"mat-list",11),A.Pb(),A.Qb(16,"mat-dialog-actions",3),A.Qb(17,"button",12),A.Cc(18," Cancel "),A.Pb(),A.Qb(19,"button",13),A.Cc(20," Save "),A.Pb(),A.Pb(),A.Nb()),2&e){var n=A.oc(5),a=A.cc();A.wb(6),A.ic("value",a.data.data.emailtemplateid),A.wb(4),A.ic("value",a.data.data.fromname),A.wb(4),A.ic("value",a.data.data.subject),A.wb(1),A.ic("ngIf",a.data.mergeFields),A.wb(4),A.ic("disabled",!a.checkValidity(n))("mat-dialog-close",n)}}function X(e,t){if(1&e&&(A.Ob(0),A.Qb(1,"h2",2),A.Cc(2,"Send test email"),A.Pb(),A.Qb(3,"mat-dialog-content"),A.Lb(4,"form",null,17),A.Pb(),A.Qb(6,"mat-dialog-actions",3),A.Qb(7,"button",4),A.Cc(8," No, Go back! "),A.Pb(),A.Qb(9,"button",5),A.Cc(10," Yes, Close it. "),A.Pb(),A.Pb(),A.Nb()),2&e){var n=A.oc(5);A.wb(9),A.ic("mat-dialog-close",n)}}var J,V,Z=((J=function(){function e(t){_classCallCheck(this,e),this.data=t}return _createClass(e,[{key:"checkValidity",value:function(e){return e.checkValidity()}}]),e}()).\u0275fac=function(e){return new(e||J)(A.Kb(S.a))},J.\u0275cmp=A.Eb({type:J,selectors:[["app-modal-dialog"]],decls:5,vars:4,consts:[[1,"mat-typography"],[4,"ngIf"],["mat-dialog-title",""],["fxLayoutAlign","space-between center"],["mat-button","","color","warn","cdkFocusInitial","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["form",""],["type","hidden","name","emailtemplateid",3,"value"],["appearance","fill"],["matInput","","name","fromname","required","","type","text",3,"value"],["matInput","","name","subject","required","","type","text",3,"value"],["dense","",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary","cdkFocusInitial","",3,"disabled","mat-dialog-close"],["dense",""],[4,"ngFor","ngForOf"],["fxFlex","","fxLayout","","fxLayoutAlign","space-between center"],["form","ngForm"]],template:function(e,t){1&e&&(A.Qb(0,"div",0),A.Ac(1,B,10,1,"ng-container",1),A.Ac(2,q,18,1,"ng-container",1),A.Ac(3,W,21,6,"ng-container",1),A.Ac(4,X,11,1,"ng-container",1),A.Pb()),2&e&&(A.wb(1),A.ic("ngIf","confirm"===t.data.type),A.wb(1),A.ic("ngIf","confirm-revert"===t.data.type),A.wb(1),A.ic("ngIf","edit"===t.data.type),A.wb(1),A.ic("ngIf","test-email"===t.data.type))},directives:[D.i,S.h,S.e,S.c,F.b,M.a,S.d,R.n,R.i,R.j,E.b,E.f,N.a,G.a,D.h,G.c,F.a,F.c,Y.a],styles:["[_nghost-%COMP%]{display:block}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;height:auto}mat-list[_ngcontent-%COMP%]{max-height:300px;overflow:auto}mat-list[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all}"]}),J),ee=n("XhcP"),te=n("/t3+"),ne=n("STbY"),ae=n("7EHt"),ie=n("bv9b"),ce=n("+0xr"),re=n("1jcm"),oe=n("Qu3c"),le=n("NFeN"),se=((V=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e){return e.split("_").join(" ")}}]),e}()).\u0275fac=function(e){return new(e||V)},V.\u0275pipe=A.Jb({name:"keyToLang",type:V,pure:!0}),V),ue=["sidenav"];function be(e,t){1&e&&A.Lb(0,"mat-progress-bar",15)}function de(e,t){if(1&e&&(A.Qb(0,"button",16),A.Cc(1),A.Pb()),2&e){var n=t.ngIf;A.wb(1),A.Ec(" ",n," ")}}function pe(e,t){if(1&e){var n=A.Rb();A.Ob(0),A.Qb(1,"button",19),A.Yb("click",(function(){A.rc(n);var e=t.$implicit;return A.cc(3).changeLanguage(e)})),A.Cc(2),A.dc(3,"keyToLang"),A.Pb(),A.Nb()}if(2&e){var a=t.$implicit;A.wb(2),A.Ec(" ",A.ec(3,1,a)," ")}}function me(e,t){if(1&e&&A.Ac(0,pe,4,3,"ng-container",18),2&e){var n=A.cc().ngIf;A.ic("ngForOf",n)}}function fe(e,t){1&e&&A.Ac(0,me,1,1,"ng-template",17)}function ge(e,t){if(1&e&&(A.Qb(0,"div",20),A.Cc(1," Please add "),A.Qb(2,"a",21),A.Cc(3,"Purchase Code"),A.Pb(),A.Cc(4," to the options page to use this builder. "),A.Pb()),2&e){var n=A.cc();A.wb(2),A.ic("href",n.baseUrl+"/options",A.uc)}}function he(e,t){1&e&&A.Lb(0,"mat-header-cell")}function ve(e,t){if(1&e){var n=A.Rb();A.Qb(0,"mat-cell"),A.Qb(1,"mat-slide-toggle",36),A.Yb("change",(function(e){A.rc(n);var a=t.$implicit;return A.cc(2).changeActiveStatus(e,a)})),A.dc(2,"async"),A.Pb(),A.Pb()}if(2&e){var a=t.$implicit,i=A.cc(2);A.wb(1),A.ic("checked",a.active-0==1)("disabled",A.ec(2,2,i.res.isLoading$))}}function ye(e,t){1&e&&(A.Qb(0,"mat-header-cell"),A.Cc(1,"Name"),A.Pb())}function we(e,t){if(1&e&&(A.Qb(0,"span"),A.Cc(1),A.Pb()),2&e){var n=A.cc().$implicit;A.wb(1),A.Dc(n.name)}}function Pe(e,t){if(1&e&&(A.Qb(0,"del"),A.Cc(1),A.Pb()),2&e){var n=A.cc().$implicit;A.wb(1),A.Dc(n.name)}}function Oe(e,t){if(1&e&&(A.Qb(0,"mat-cell"),A.Ac(1,we,2,1,"span",8),A.Ac(2,Pe,2,1,"del",8),A.Pb()),2&e){var n=t.$implicit;A.wb(1),A.ic("ngIf","1"===n.active),A.wb(1),A.ic("ngIf","1"!==n.active)}}function Ce(e,t){1&e&&(A.Qb(0,"mat-header-cell"),A.Cc(1," From Name > Subject "),A.Pb())}function ke(e,t){if(1&e&&(A.Qb(0,"span"),A.Cc(1),A.Pb()),2&e){var n=A.cc().$implicit;A.wb(1),A.Ec(" ",n.fromname," > ")}}function je(e,t){if(1&e){var n=A.Rb();A.Qb(0,"mat-cell",37),A.Qb(1,"div"),A.Ac(2,ke,2,1,"span",8),A.Cc(3),A.Pb(),A.Qb(4,"div",38),A.Qb(5,"span",39),A.Cc(6),A.dc(7,"date"),A.Pb(),A.Qb(8,"button",40),A.Yb("click",(function(){A.rc(n);var e=t.$implicit,a=A.cc().$implicit;return A.cc().changeElementDetails(e,a.key)})),A.dc(9,"async"),A.Qb(10,"mat-icon"),A.Cc(11,"edit"),A.Pb(),A.Pb(),A.Pb(),A.Pb()}if(2&e){var a=t.$implicit,i=A.cc(2);A.wb(2),A.ic("ngIf",a.fromname),A.wb(1),A.Ec(" ",a.subject," "),A.wb(3),A.Ec(" ",A.fc(7,4,i.getUpdatedDate(a),"short")," "),A.wb(2),A.ic("disabled",A.ec(9,7,i.res.isLoading$))}}function _e(e,t){1&e&&(A.Qb(0,"mat-header-cell",41),A.Cc(1," Actions "),A.Pb())}function xe(e,t){1&e&&(A.Qb(0,"mat-icon"),A.Cc(1," visibility "),A.Pb())}function Qe(e,t){1&e&&(A.Qb(0,"mat-icon"),A.Cc(1," visibility_off "),A.Pb())}function Te(e,t){if(1&e){var n=A.Rb();A.Qb(0,"mat-cell",42),A.Qb(1,"button",43),A.Yb("click",(function(){A.rc(n);var e=t.$implicit,a=A.cc().$implicit;return A.cc().editTemplate(e,a.key)})),A.dc(2,"async"),A.Qb(3,"mat-icon"),A.Cc(4,"dashboard"),A.Pb(),A.Pb(),A.Qb(5,"button",44),A.Yb("click",(function(){A.rc(n);var e=t.$implicit,a=A.cc().$implicit;return A.cc().previewTemplate(e,a.key)})),A.dc(6,"async"),A.Ac(7,xe,2,0,"mat-icon",8),A.Ac(8,Qe,2,0,"mat-icon",8),A.Pb(),A.Pb()}if(2&e){var a=t.$implicit,i=A.cc(2);A.wb(1),A.ic("disabled",A.ec(2,4,i.res.isLoading$)),A.wb(4),A.ic("disabled",A.ec(6,6,i.res.isLoading$)),A.wb(2),A.ic("ngIf",a.active-0==1),A.wb(1),A.ic("ngIf",a.active-0==0)}}function Ae(e,t){1&e&&A.Lb(0,"mat-header-row")}function $e(e,t){1&e&&A.Lb(0,"mat-row")}function Le(e,t){if(1&e){var n=A.Rb();A.Qb(0,"mat-expansion-panel",22),A.Yb("opened",(function(){A.rc(n);var e=t.$implicit;return A.cc().expansionPanelOpen(e.key)})),A.Qb(1,"mat-expansion-panel-header"),A.Qb(2,"mat-panel-title",23),A.Cc(3),A.dc(4,"keyToLang"),A.Pb(),A.Pb(),A.Qb(5,"mat-table",24),A.Ob(6,25),A.Ac(7,he,1,0,"mat-header-cell",26),A.Ac(8,ve,3,4,"mat-cell",27),A.Nb(),A.Ob(9,28),A.Ac(10,ye,2,0,"mat-header-cell",26),A.Ac(11,Oe,3,2,"mat-cell",27),A.Nb(),A.Ob(12,29),A.Ac(13,Ce,2,0,"mat-header-cell",26),A.Ac(14,je,12,9,"mat-cell",30),A.Nb(),A.Ob(15,31),A.Ac(16,_e,2,0,"mat-header-cell",32),A.Ac(17,Te,9,8,"mat-cell",33),A.Nb(),A.Ac(18,Ae,1,0,"mat-header-row",34),A.Ac(19,$e,1,0,"mat-row",35),A.Pb(),A.Pb()}if(2&e){var a=t.$implicit,i=A.cc();A.ic("expanded",a.key===i.expansionPanelOpen()),A.wb(3),A.Ec(" ",A.ec(4,5,a.key)," "),A.wb(2),A.ic("dataSource",a.value),A.wb(13),A.ic("matHeaderRowDef",i.displayedColumns),A.wb(1),A.ic("matRowDefColumns",i.displayedColumns)}}function Ie(e,t){1&e&&(A.Qb(0,"span"),A.Cc(1,"\xa0[Unedited]"),A.Pb())}function Se(e,t){if(1&e){var n=A.Rb();A.Ob(0),A.Qb(1,"mat-toolbar",45),A.Qb(2,"mat-toolbar-row"),A.Qb(3,"span"),A.Cc(4),A.Pb(),A.Ac(5,Ie,2,0,"span",8),A.Qb(6,"button",46),A.Yb("click",(function(){A.rc(n);var e=A.cc().ngIf;return A.cc().openBuilderFromPreview(e)})),A.Cc(7," Edit it on builder "),A.Pb(),A.Pb(),A.Pb(),A.Lb(8,"ip-preview-template",47),A.Nb()}if(2&e){var a=A.cc().ngIf;A.wb(4),A.Dc(a.name),A.wb(1),A.ic("ngIf",!a.is_edited),A.wb(3),A.ic("template",a.html)}}function De(e,t){if(1&e){var n=A.Rb();A.Ob(0),A.Qb(1,"mat-toolbar",45),A.Qb(2,"mat-toolbar-row"),A.Qb(3,"span"),A.Cc(4),A.Pb(),A.Qb(5,"div",48),A.Qb(6,"button",49),A.Yb("click",(function(){return A.rc(n),A.cc(2).backdropClick()})),A.Cc(7," Close Builder "),A.Pb(),A.Pb(),A.Pb(),A.Pb(),A.Qb(8,"ip-email-builder",50),A.Qb(9,"div",51),A.Qb(10,"button",52),A.Yb("click",(function(){A.rc(n);var e=A.cc().ngIf;return A.cc().saveEmail(e)})),A.Cc(11," Save "),A.Pb(),A.Qb(12,"button",49),A.Yb("click",(function(){return A.rc(n),A.cc(2).revertTemplateBack()})),A.Cc(13," Revert Template "),A.Pb(),A.Pb(),A.Pb(),A.Nb()}if(2&e){var a=A.cc().ngIf;A.wb(4),A.Dc(a.name),A.wb(4),A.ic("email",a.template)}}function Fe(e,t){if(1&e&&(A.Ob(0),A.Ac(1,Se,9,3,"ng-container",8),A.Ac(2,De,14,2,"ng-container",8),A.Nb()),2&e){var n=t.ngIf;A.wb(1),A.ic("ngIf",n.html),A.wb(1),A.ic("ngIf",n.template)}}function Me(){return Object(b.a)((function(e){return null!==e}))}var Re,Ee=((Re=function(){function e(t,n,u,b,g){var h=this;_classCallCheck(this,e),this.res=t,this.ngb=n,this.dialog=u,this.snack=b,this.el=g,this.onDestroy$=new a.a,this.activeLanguage$=new i.a(globalThis.NGB.activeLanguage),this.previewTemplate$=new i.a(null),this.editTemplateObject$=new i.a(null),this.updatedStore=new Map,this.removeUpdatedStore=new Set,this.displayedColumns=["active","name","subject","actions"],this.pKey=globalThis.NGB.purchaseCode,this.baseUrl=globalThis.NGB.baseUrl,this.languages$=this.res.getAllLanguages().pipe(Object(d.a)((function(e){return h.getActiveLanguage$.pipe(Object(p.a)((function(t){return[].concat(_toConsumableArray(e),[globalThis.NGB.activeLanguage]).filter((function(e){return e!==t})).sort()})))}))),this.getActiveLanguage$=this.activeLanguage$.asObservable(),this.keyDowns$=Object(c.a)(this.el.nativeElement,"keydown").pipe(Object(m.a)((function(e){h.sidenav.opened&&e.stopImmediatePropagation()})),Object(f.a)(this.onDestroy$)),this.getTemplates$=this.getActiveLanguage$.pipe(Object(d.a)((function(e){return h.res.getTemplatesByLang(e)})),Object(f.a)(this.onDestroy$)),this.getTemplateObject$=this.editTemplateObject$.pipe(w(r.a),Object(d.a)((function(e){return h.pKey||h.snack.open("Please provide the purchase code before editing any templates.",null,{duration:1e4}),h.pKey&&e?Object(l.a)([h.res.getTemplate(e.id),h.res.getAllMergeFields(e.type)]).pipe(Object(p.a)((function(t){var n=_slicedToArray(t,2),a=n[0],i=n[1];return h.ngb.MergeTags=new Set(i.map((function(e){return e.key}))),Object.assign(Object.assign({},e),{template:new x.a(Object.assign({structures:[new x.f("cols_1",[[new x.g(a.template.message)]])]},a.template))})})),Object(m.a)((function(){h.previewTemplate$.next(null),h.sidenav.open()}))):Object(o.a)(null)})),Object(f.a)(this.onDestroy$)),this.getPreviewTemplate$=this.previewTemplate$.pipe(w(r.a),Object(d.a)((function(e){return e?h.res.getTemplateBody(e.id).pipe(Object(p.a)((function(t){return Object.assign(Object.assign({},e),t)})),Object(m.a)((function(){h.editTemplateObject$.next(null),h.sidenav.open()}))):Object(o.a)(null)})),Object(f.a)(this.onDestroy$)),this.sidenavDetails$=Object(s.a)([this.getTemplateObject$,this.getPreviewTemplate$]).pipe(w(r.a),Object(p.a)((function(e){var t=_slicedToArray(e,2),n=t[0],a=t[1];return n||a})))}return _createClass(e,[{key:"changeLanguage",value:function(e){this.activeLanguage$.next(e)}},{key:"editTemplate",value:function(e,t){this.editTemplateObject$.next({id:e.emailtemplateid,type:t,name:e.name})}},{key:"previewTemplate",value:function(e,t){this.previewTemplate$.next({id:e.emailtemplateid,type:t,name:e.name})}},{key:"closeSidenav",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Object(o.a)("").pipe(Object(C.a)((function(){return t&&e.ngb.hasChanges?e.dialog.open(Z,{data:{type:"confirm"},width:"300px",maxWidth:"100%"}).afterClosed().pipe(Object(p.a)(Boolean)):Object(o.a)(!0)})),Object(m.a)((function(t){return t&&e.sidenav.close()})))}},{key:"backdropClick",value:function(){var e=this;return this.closeSidenav().pipe(Object(k.a)(1)).subscribe((function(t){t&&(e.editTemplateObject$.next(null),e.previewTemplate$.next(null))}))}},{key:"getUpdatedDate",value:function(e){var t=e.emailtemplateid;return this.removeUpdatedStore.has(t)?null:this.updatedStore.get(t)||e.updated_at||null}},{key:"openBuilderFromPreview",value:function(e){var t=this,n=e.id,a=e.name,i=e.type;return this.closeSidenav(!1).pipe(Object(k.a)(1)).subscribe((function(e){e&&t.editTemplateObject$.next({id:n,name:a,type:i})}))}},{key:"expansionPanelOpen",value:function(e){return e&&localStorage.setItem("expansionPanelOpened",e),localStorage.getItem("expansionPanelOpened")||"client"}},{key:"saveEmail",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=new FormData;return this.editTemplateObject$.pipe(Me(),Object(d.a)((function(e){return a.append("emailtemplateid",e.id),t.ngb.saveEmail().pipe(Object(d.a)((function(e){var n=e.html;return a.append("emailObject",JSON.stringify(t.ngb.Email)),a.append("template",n),t.res.sendPostRequest(a,"update")})),Object(j.a)((function(e){return console.error(e),t.ngb.notify("Something bad happened."),u.a})),Object(_.a)((function(){return t.updatedStore.set(e.id,new Date)})))})),Object(d.a)((function(e){var a=e.success;return a&&n?t.closeSidenav(!1):Object(o.a)(a)})),Object(k.a)(1)).subscribe((function(n){n&&(e.isEdited=!0,t.ngb.notify("Email template has been saved successfully."))}))}},{key:"changeActiveStatus",value:function(e,t){var n=this,a=e.checked,i=e.source,c=a?1:0,r=new FormData;return r.append("emailtemplateid",t.emailtemplateid),r.append("active",String(c)),this.res.sendPostRequest(r,"changeActiveStatus").pipe(Object(j.a)((function(){return i.toggle(),u.a})),Object(k.a)(1)).subscribe((function(e){e.success?(t.active=c,n.updatedStore.set(t.emailtemplateid,new Date)):i.toggle()}))}},{key:"changeElementDetails",value:function(e,t){var n=this;return this.res.getAllMergeFields(t).pipe(Object(C.a)((function(t){return n.dialog.open(Z,{data:{type:"edit",data:e,mergeFields:t},width:"450px",maxWidth:"100%"}).afterClosed()})),Object(d.a)((function(e){if(!e)return Object(o.a)({success:!1,updates:null});var t=new FormData(e);return n.res.sendPostRequest(t,"updateDetails")}))).subscribe((function(t){var a=t.success,i=t.updates;a&&i&&(e.subject=i.subject,e.fromname=i.fromname,n.updatedStore.set(e.emailtemplateid,new Date),n.ngb.notify("The details have been saved."))}))}},{key:"revertTemplateBack",value:function(){var e=this;return this.editTemplateObject$.pipe(Me(),Object(C.a)((function(t){var n=t.id;return e.dialog.open(Z,{data:{type:"confirm-revert"},width:"300px",maxWidth:"100%"}).afterClosed().pipe(Object(p.a)(Boolean),Object(b.a)((function(e){return e})),Object(d.a)((function(){return e.res.revertTemplate(n).pipe(Object(_.a)((function(){e.updatedStore.delete(n),e.removeUpdatedStore.add(n)})))})))})),Object(k.a)(1)).subscribe((function(t){var n=t.email;e.ngb.Email=n}))}},{key:"ngOnInit",value:function(){this.keyDowns$.subscribe()}},{key:"ngOnDestroy",value:function(){this.onDestroy$.next(!0),this.onDestroy$.complete(),this.activeLanguage$.complete(),this.previewTemplate$.complete(),this.editTemplateObject$.complete(),this.updatedStore.clear(),this.removeUpdatedStore.clear()}}]),e}()).\u0275fac=function(e){return new(e||Re)(A.Kb(I),A.Kb(x.d),A.Kb(S.b),A.Kb(L.a),A.Kb(A.j))},Re.\u0275cmp=A.Eb({type:Re,selectors:[["ng-component"]],viewQuery:function(e,t){var n;1&e&&A.Gc(ue,!0),2&e&&A.nc(n=A.Zb())&&(t.sidenav=n.first)},decls:29,vars:22,consts:[[2,"width","100%",3,"backdropClick"],["fxLayout","column wrap","fxLayoutAlign","top center","fxLayoutGap","1rem",1,"mat-typography"],[1,"mat-elevation-z2"],["mode","indeterminate","style","position: absolute;",4,"ngIf"],["fxLayout","","fxLayoutGap","1rem",2,"margin-left","auto"],["mat-flat-button","","color","primary","class","capitalize",4,"ngIf"],["mat-flat-button","",3,"matMenuTriggerFor","disabled"],["langMenu","matMenu"],[4,"ngIf"],["fxLayout","column","fxLayoutGap","1rem",2,"padding","1rem","max-width","1400px","width","100%","box-sizing","border-box"],["class","alert alert-danger","fxFlex","",4,"ngIf"],["fxFlex",""],[3,"expanded","opened",4,"ngFor","ngForOf"],["position","end","disableClose","",2,"width","1200px","max-width","80%"],["sidenav",""],["mode","indeterminate",2,"position","absolute"],["mat-flat-button","","color","primary",1,"capitalize"],["matMenuContent",""],[4,"ngFor","ngForOf"],["mat-menu-item","",1,"capitalize",3,"click"],["fxFlex","",1,"alert","alert-danger"],[3,"href"],[3,"expanded","opened"],[1,"capitalize"],["fxFlex","",3,"dataSource"],["matColumnDef","active"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","name"],["matColumnDef","subject"],["class","subject-column","fxLayoutAlign","space-between center",4,"matCellDef"],["matColumnDef","actions"],["fxFlex","0 0 144px","fxLayoutAlign","flex-end center",4,"matHeaderCellDef"],["fxLayoutAlign","flex-end","fxFlex","0 0 auto",4,"matCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["matTooltip","Change active status","matTooltipPosition","above","disableRipple","",3,"checked","disabled","change"],["fxLayoutAlign","space-between center",1,"subject-column"],["fxLayout","","fxLayoutAlign","center center","fxLayoutGap","0.5rem"],["matTooltip","Last updated","matTooltipPosition","above"],["mat-icon-button","","matTooltip","Edit email details","matTooltipPosition","left","aria-label","Edit email details","color","primary",3,"disabled","click"],["fxFlex","0 0 144px","fxLayoutAlign","flex-end center"],["fxLayoutAlign","flex-end","fxFlex","0 0 auto"],["mat-icon-button","","matTooltip","Open on builder","matTooltipPosition","above","aria-label","Open on builder","color","accent",3,"disabled","click"],["mat-icon-button","","matTooltip","Preview","matTooltipPosition","above","aria-label","Preview","color","accent",3,"disabled","click"],["color","primary"],["mat-flat-button","","color","accent",2,"margin-left","auto",3,"click"],[2,"height","100%","justify-content","center",3,"template"],["fxLayoutGap","0.5rem",2,"margin-left","auto"],["mat-flat-button","","color","accent",3,"click"],[2,"height","inherit",3,"email"],["fxLayoutGap","0.5rem",1,"top-actions"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,t){if(1&e&&(A.Qb(0,"mat-sidenav-container",0),A.Yb("backdropClick",(function(){return t.backdropClick()})),A.Qb(1,"mat-sidenav-content"),A.Qb(2,"div",1),A.Qb(3,"mat-toolbar",2),A.Ac(4,be,1,0,"mat-progress-bar",3),A.dc(5,"async"),A.Qb(6,"mat-toolbar-row"),A.Qb(7,"h1"),A.Cc(8,"Email templates"),A.Pb(),A.Qb(9,"div",4),A.Ac(10,de,2,1,"button",5),A.dc(11,"async"),A.Qb(12,"button",6),A.dc(13,"async"),A.Cc(14," Other languages "),A.Pb(),A.Qb(15,"mat-menu",null,7),A.Ac(17,fe,1,0,void 0,8),A.dc(18,"async"),A.Pb(),A.Pb(),A.Pb(),A.Pb(),A.Qb(19,"div",9),A.Ac(20,ge,5,1,"div",10),A.Qb(21,"mat-accordion",11),A.Ac(22,Le,20,7,"mat-expansion-panel",12),A.dc(23,"keyvalue"),A.dc(24,"async"),A.Pb(),A.Pb(),A.Pb(),A.Pb(),A.Qb(25,"mat-sidenav",13,14),A.Ac(27,Fe,3,2,"ng-container",8),A.dc(28,"async"),A.Pb(),A.Pb()),2&e){var n=A.oc(16);A.wb(4),A.ic("ngIf",A.ec(5,8,t.res.isLoading$)),A.wb(6),A.ic("ngIf",A.ec(11,10,t.getActiveLanguage$)),A.wb(2),A.ic("matMenuTriggerFor",n)("disabled",A.ec(13,12,t.res.isLoading$)),A.wb(5),A.ic("ngIf",A.ec(18,14,t.languages$)),A.wb(3),A.ic("ngIf",!t.pKey),A.wb(2),A.ic("ngForOf",A.ec(23,16,A.ec(24,18,t.getTemplates$))),A.wb(5),A.ic("ngIf",A.ec(28,20,t.sidenavDetails$))}},directives:[ee.b,ee.c,F.c,F.b,F.d,te.a,D.i,te.c,M.a,ne.d,ne.e,ae.a,F.a,D.h,ee.a,ie.a,ne.a,ne.b,ae.c,ae.e,ae.f,ce.j,ce.c,ce.e,ce.b,ce.g,ce.i,ce.d,ce.a,re.a,oe.a,le.a,ce.f,ce.h,x.e,x.b],pipes:[D.a,D.e,se,D.d],styles:["[_nghost-%COMP%]{display:block;height:inherit}[_nghost-%COMP%], mat-sidenav-container[_ngcontent-%COMP%]{min-height:inherit}mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:first-child{max-width:84px}mat-cell[_ngcontent-%COMP%]:first-child{max-width:-webkit-fit-content;max-width:-moz-fit-content;max-width:fit-content;padding-right:24px}mat-cell[_ngcontent-%COMP%]:nth-child(2), mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:nth-child(2){max-width:400px;border-right:1px solid #e0e0e0}mat-cell[_ngcontent-%COMP%]:nth-child(3), mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:nth-child(3){padding-left:24px}.subject-column[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{opacity:0;transition:all .3s ease-in-out;will-change:opacity}.subject-column[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:1}.subject-column[_ngcontent-%COMP%]:hover   button[_ngcontent-%COMP%]:not(:hover){opacity:.5}.mat-drawer-container[_ngcontent-%COMP%]{background:transparent;height:inherit}.force-select[_ngcontent-%COMP%]{-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all;margin-bottom:1rem}"],changeDetection:0}),Re)}}]);