(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{BsGo:function(e,t,a){"use strict";a.r(t),a.d(t,"TemplatesComponent",(function(){return Fe}));var n=a("XNiG"),i=a("2Vo4"),c=a("xgIS"),o=a("eNwd"),s=a("LRne"),l=a("cp0P"),b=a("itXk"),r=a("EY2u"),d=a("pLZG"),m=a("XqQ8"),p=a("lJxs"),u=a("vkgz"),g=a("1G5W"),h=a("HDdC"),f=a("7Hc7"),w=a("Y7HM");class P extends h.a{constructor(e,t=0,a=f.a){super(),this.source=e,this.delayTime=t,this.scheduler=a,(!Object(w.a)(t)||t<0)&&(this.delayTime=0),a&&"function"==typeof a.schedule||(this.scheduler=f.a)}static create(e,t=0,a=f.a){return new P(e,t,a)}static dispatch(e){const{source:t,subscriber:a}=e;return this.add(t.subscribe(a))}_subscribe(e){return this.scheduler.schedule(P.dispatch,this.delayTime,{source:this.source,subscriber:e})}}function y(e,t=0){return function(a){return a.lift(new O(e,t))}}class O{constructor(e,t){this.scheduler=e,this.delay=t}call(e,t){return new P(t,this.delay,this.scheduler).subscribe(e)}}var v=a("eIep"),C=a("IzEk"),x=a("JIr8"),j=a("nYR2"),Q=a("uSps"),$=a("z6cu"),k=a("UXun"),T=a("fXoL"),L=a("tk/3"),A=a("dNgK");let I=(()=>{class e{constructor(e,t){this.http=e,this.matSnack=t,this._isLoading$=new n.a,this.isLoading$=this._isLoading$.asObservable()}httpRequest(e,t={},a="get",n){return this._isLoading$.next(!0),this.matSnack.open("Please wait..."),this.http.request(a,`${globalThis.NGB.baseUrl}/${e}`,{params:t,body:n,responseType:"json"}).pipe(Object(x.a)(e=>(e.error instanceof ErrorEvent?console.error("An error occurred:",e.error.message):(console.error(`Backend returned code ${e.status}`),this.matSnack.open(`Something bad happened; please try again later. "Error Status ${e.status}".`,"Close",{announcementMessage:"Something bad happened; please try again later."})),console.error(e),Object($.a)(new Error("Something bad happened; please try again later.")))),Object(u.a)(()=>this.matSnack.dismiss()),Object(j.a)(()=>this._isLoading$.next(!1)))}getTemplatesByLang(e){return this.httpRequest("templates",{language:e})}getTemplateBody(e){return this.httpRequest("getEmailTemplate",{id:e})}getTemplate(e){return this.httpRequest("getTemplate",{id:e})}revertTemplate(e){return this.sendPostRequest(new FormData,`revertTemplate/${e}`).pipe(Object(p.a)(e=>({isEdited:!1,email:new Q.a({structures:[new Q.f("cols_1",[[new Q.g(e.message)]])]})})))}getAllLanguages(){return this.httpRequest("languages").pipe(Object(k.a)(),Object(x.a)(()=>Object(s.a)([])))}getAllMergeFields(e){return this.httpRequest("mergeFields",{type:e}).pipe(Object(x.a)(()=>Object(s.a)([])))}sendPostRequest(e=new FormData,t){const{token:a,name:n}=globalThis.NGB.csrf;return e.append(n,a),this.httpRequest(t,{},"post",e)}}return e.\u0275fac=function(t){return new(t||e)(T.Ub(L.b),T.Ub(A.a))},e.\u0275prov=T.Gb({token:e,factory:e.\u0275fac,providedIn:"any"}),e})();var D=a("0IaG"),S=a("ofXK"),F=a("XiUz"),M=a("bTqV"),_=a("3Pt+"),E=a("kmnG"),N=a("qFsG"),R=a("MutI"),G=a("f0Cb");function Y(e,t){1&e&&(T.Ob(0),T.Qb(1,"h2",2),T.Cc(2,"Are you sure?"),T.Pb(),T.Qb(3,"mat-dialog-content"),T.Cc(4," You are about to close the builder, but there're unsaved changes, which will be lost. Are you sure? "),T.Pb(),T.Qb(5,"mat-dialog-actions",3),T.Qb(6,"button",4),T.Cc(7," No, Go back! "),T.Pb(),T.Qb(8,"button",5),T.Cc(9," Yes, Close it. "),T.Pb(),T.Pb(),T.Nb()),2&e&&(T.wb(8),T.ic("mat-dialog-close",!0))}function B(e,t){1&e&&(T.Ob(0),T.Qb(1,"h2",2),T.Cc(2,"Are you sure?"),T.Pb(),T.Qb(3,"mat-dialog-content"),T.Qb(4,"p"),T.Cc(5,"You are about to restore this template to default Perfex template, all additional changes will be lost."),T.Pb(),T.Qb(6,"p"),T.Qb(7,"strong"),T.Qb(8,"strong"),T.Cc(9,"This will affect only template body, not name nor subject."),T.Pb(),T.Pb(),T.Pb(),T.Qb(10,"p"),T.Qb(11,"strong"),T.Cc(12,"Are you sure?"),T.Pb(),T.Pb(),T.Pb(),T.Qb(13,"mat-dialog-actions",3),T.Qb(14,"button",4),T.Cc(15," No, Go back! "),T.Pb(),T.Qb(16,"button",5),T.Cc(17," Yes, Restore it. "),T.Pb(),T.Pb(),T.Nb()),2&e&&(T.wb(16),T.ic("mat-dialog-close",!0))}function q(e,t){if(1&e&&(T.Qb(0,"mat-list-item"),T.Qb(1,"div",16),T.Qb(2,"span"),T.Cc(3),T.Pb(),T.Qb(4,"code"),T.Cc(5),T.Pb(),T.Pb(),T.Pb()),2&e){const e=T.cc().$implicit;T.wb(3),T.Dc(e.name),T.wb(2),T.Dc(e.key)}}function U(e,t){1&e&&T.Lb(0,"mat-divider")}function z(e,t){if(1&e&&(T.Ob(0),T.Ac(1,q,6,2,"mat-list-item",1),T.Ac(2,U,1,0,"mat-divider",1),T.Nb()),2&e){const e=t.$implicit;T.wb(1),T.ic("ngIf",e.key),T.wb(1),T.ic("ngIf",e.key)}}function K(e,t){if(1&e&&(T.Qb(0,"mat-list",14),T.Ac(1,z,3,2,"ng-container",15),T.Pb()),2&e){const e=T.cc(2);T.wb(1),T.ic("ngForOf",e.data.mergeFields)}}function H(e,t){if(1&e&&(T.Ob(0),T.Qb(1,"h2",2),T.Cc(2,"Edit details"),T.Pb(),T.Qb(3,"mat-dialog-content"),T.Qb(4,"form",null,6),T.Lb(6,"input",7),T.Qb(7,"mat-form-field",8),T.Qb(8,"mat-label"),T.Cc(9,"From Name"),T.Pb(),T.Lb(10,"input",9),T.Pb(),T.Qb(11,"mat-form-field",8),T.Qb(12,"mat-label"),T.Cc(13,"Subject"),T.Pb(),T.Lb(14,"input",10),T.Pb(),T.Pb(),T.Ac(15,K,2,1,"mat-list",11),T.Pb(),T.Qb(16,"mat-dialog-actions",3),T.Qb(17,"button",12),T.Cc(18," Cancel "),T.Pb(),T.Qb(19,"button",13),T.Cc(20," Save "),T.Pb(),T.Pb(),T.Nb()),2&e){const e=T.oc(5),t=T.cc();T.wb(6),T.ic("value",t.data.data.emailtemplateid),T.wb(4),T.ic("value",t.data.data.fromname),T.wb(4),T.ic("value",t.data.data.subject),T.wb(1),T.ic("ngIf",t.data.mergeFields),T.wb(4),T.ic("disabled",!t.checkValidity(e))("mat-dialog-close",e)}}function X(e,t){if(1&e&&(T.Ob(0),T.Qb(1,"h2",2),T.Cc(2,"Send test email"),T.Pb(),T.Qb(3,"mat-dialog-content"),T.Lb(4,"form",null,17),T.Pb(),T.Qb(6,"mat-dialog-actions",3),T.Qb(7,"button",4),T.Cc(8," No, Go back! "),T.Pb(),T.Qb(9,"button",5),T.Cc(10," Yes, Close it. "),T.Pb(),T.Pb(),T.Nb()),2&e){const e=T.oc(5);T.wb(9),T.ic("mat-dialog-close",e)}}let J=(()=>{class e{constructor(e){this.data=e}checkValidity(e){return e.checkValidity()}}return e.\u0275fac=function(t){return new(t||e)(T.Kb(D.a))},e.\u0275cmp=T.Eb({type:e,selectors:[["app-modal-dialog"]],decls:5,vars:4,consts:[[1,"mat-typography"],[4,"ngIf"],["mat-dialog-title",""],["fxLayoutAlign","space-between center"],["mat-button","","color","warn","cdkFocusInitial","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["form",""],["type","hidden","name","emailtemplateid",3,"value"],["appearance","fill"],["matInput","","name","fromname","required","","type","text",3,"value"],["matInput","","name","subject","required","","type","text",3,"value"],["dense","",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary","cdkFocusInitial","",3,"disabled","mat-dialog-close"],["dense",""],[4,"ngFor","ngForOf"],["fxFlex","","fxLayout","","fxLayoutAlign","space-between center"],["form","ngForm"]],template:function(e,t){1&e&&(T.Qb(0,"div",0),T.Ac(1,Y,10,1,"ng-container",1),T.Ac(2,B,18,1,"ng-container",1),T.Ac(3,H,21,6,"ng-container",1),T.Ac(4,X,11,1,"ng-container",1),T.Pb()),2&e&&(T.wb(1),T.ic("ngIf","confirm"===t.data.type),T.wb(1),T.ic("ngIf","confirm-revert"===t.data.type),T.wb(1),T.ic("ngIf","edit"===t.data.type),T.wb(1),T.ic("ngIf","test-email"===t.data.type))},directives:[S.i,D.h,D.e,D.c,F.b,M.a,D.d,_.n,_.i,_.j,E.b,E.f,N.a,R.a,S.h,R.c,F.a,F.c,G.a],styles:["[_nghost-%COMP%]{display:block}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;height:auto}mat-list[_ngcontent-%COMP%]{max-height:300px;overflow:auto}mat-list[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all}"]}),e})();var V=a("XhcP"),W=a("/t3+"),Z=a("STbY"),ee=a("7EHt"),te=a("bv9b"),ae=a("+0xr"),ne=a("1jcm"),ie=a("Qu3c"),ce=a("NFeN");let oe=(()=>{class e{transform(e,...t){return e.split("_").join(" ")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=T.Jb({name:"keyToLang",type:e,pure:!0}),e})();const se=["sidenav"];function le(e,t){1&e&&T.Lb(0,"mat-progress-bar",15)}function be(e,t){if(1&e&&(T.Qb(0,"button",16),T.Cc(1),T.Pb()),2&e){const e=t.ngIf;T.wb(1),T.Ec(" ",e," ")}}function re(e,t){if(1&e){const e=T.Rb();T.Ob(0),T.Qb(1,"button",19),T.Yb("click",(function(){T.rc(e);const a=t.$implicit;return T.cc(3).changeLanguage(a)})),T.Cc(2),T.dc(3,"keyToLang"),T.Pb(),T.Nb()}if(2&e){const e=t.$implicit;T.wb(2),T.Ec(" ",T.ec(3,1,e)," ")}}function de(e,t){if(1&e&&T.Ac(0,re,4,3,"ng-container",18),2&e){const e=T.cc().ngIf;T.ic("ngForOf",e)}}function me(e,t){1&e&&T.Ac(0,de,1,1,"ng-template",17)}function pe(e,t){if(1&e&&(T.Qb(0,"div",20),T.Cc(1," Please add "),T.Qb(2,"a",21),T.Cc(3,"Purchase Code"),T.Pb(),T.Cc(4," to the options page to use this builder. "),T.Pb()),2&e){const e=T.cc();T.wb(2),T.ic("href",e.baseUrl+"/options",T.uc)}}function ue(e,t){1&e&&T.Lb(0,"mat-header-cell")}function ge(e,t){if(1&e){const e=T.Rb();T.Qb(0,"mat-cell"),T.Qb(1,"mat-slide-toggle",36),T.Yb("change",(function(a){T.rc(e);const n=t.$implicit;return T.cc(2).changeActiveStatus(a,n)})),T.dc(2,"async"),T.Pb(),T.Pb()}if(2&e){const e=t.$implicit,a=T.cc(2);T.wb(1),T.ic("checked",e.active-0==1)("disabled",T.ec(2,2,a.res.isLoading$))}}function he(e,t){1&e&&(T.Qb(0,"mat-header-cell"),T.Cc(1,"Name"),T.Pb())}function fe(e,t){if(1&e&&(T.Qb(0,"span"),T.Cc(1),T.Pb()),2&e){const e=T.cc().$implicit;T.wb(1),T.Dc(e.name)}}function we(e,t){if(1&e&&(T.Qb(0,"del"),T.Cc(1),T.Pb()),2&e){const e=T.cc().$implicit;T.wb(1),T.Dc(e.name)}}function Pe(e,t){if(1&e&&(T.Qb(0,"mat-cell"),T.Ac(1,fe,2,1,"span",8),T.Ac(2,we,2,1,"del",8),T.Pb()),2&e){const e=t.$implicit;T.wb(1),T.ic("ngIf","1"===e.active),T.wb(1),T.ic("ngIf","1"!==e.active)}}function ye(e,t){1&e&&(T.Qb(0,"mat-header-cell"),T.Cc(1," From Name > Subject "),T.Pb())}function Oe(e,t){if(1&e&&(T.Qb(0,"span"),T.Cc(1),T.Pb()),2&e){const e=T.cc().$implicit;T.wb(1),T.Ec(" ",e.fromname," > ")}}function ve(e,t){if(1&e){const e=T.Rb();T.Qb(0,"mat-cell",37),T.Qb(1,"div"),T.Ac(2,Oe,2,1,"span",8),T.Cc(3),T.Pb(),T.Qb(4,"div",38),T.Qb(5,"span",39),T.Cc(6),T.dc(7,"date"),T.Pb(),T.Qb(8,"button",40),T.Yb("click",(function(){T.rc(e);const a=t.$implicit,n=T.cc().$implicit;return T.cc().changeElementDetails(a,n.key)})),T.dc(9,"async"),T.Qb(10,"mat-icon"),T.Cc(11,"edit"),T.Pb(),T.Pb(),T.Pb(),T.Pb()}if(2&e){const e=t.$implicit,a=T.cc(2);T.wb(2),T.ic("ngIf",e.fromname),T.wb(1),T.Ec(" ",e.subject," "),T.wb(3),T.Ec(" ",T.fc(7,4,a.getUpdatedDate(e),"short")," "),T.wb(2),T.ic("disabled",T.ec(9,7,a.res.isLoading$))}}function Ce(e,t){1&e&&(T.Qb(0,"mat-header-cell",41),T.Cc(1," Actions "),T.Pb())}function xe(e,t){1&e&&(T.Qb(0,"mat-icon"),T.Cc(1," visibility "),T.Pb())}function je(e,t){1&e&&(T.Qb(0,"mat-icon"),T.Cc(1," visibility_off "),T.Pb())}function Qe(e,t){if(1&e){const e=T.Rb();T.Qb(0,"mat-cell",42),T.Qb(1,"button",43),T.Yb("click",(function(){T.rc(e);const a=t.$implicit,n=T.cc().$implicit;return T.cc().editTemplate(a,n.key)})),T.dc(2,"async"),T.Qb(3,"mat-icon"),T.Cc(4,"dashboard"),T.Pb(),T.Pb(),T.Qb(5,"button",44),T.Yb("click",(function(){T.rc(e);const a=t.$implicit,n=T.cc().$implicit;return T.cc().previewTemplate(a,n.key)})),T.dc(6,"async"),T.Ac(7,xe,2,0,"mat-icon",8),T.Ac(8,je,2,0,"mat-icon",8),T.Pb(),T.Pb()}if(2&e){const e=t.$implicit,a=T.cc(2);T.wb(1),T.ic("disabled",T.ec(2,4,a.res.isLoading$)),T.wb(4),T.ic("disabled",T.ec(6,6,a.res.isLoading$)),T.wb(2),T.ic("ngIf",e.active-0==1),T.wb(1),T.ic("ngIf",e.active-0==0)}}function $e(e,t){1&e&&T.Lb(0,"mat-header-row")}function ke(e,t){1&e&&T.Lb(0,"mat-row")}function Te(e,t){if(1&e){const e=T.Rb();T.Qb(0,"mat-expansion-panel",22),T.Yb("opened",(function(){T.rc(e);const a=t.$implicit;return T.cc().expansionPanelOpen(a.key)})),T.Qb(1,"mat-expansion-panel-header"),T.Qb(2,"mat-panel-title",23),T.Cc(3),T.dc(4,"keyToLang"),T.Pb(),T.Pb(),T.Qb(5,"mat-table",24),T.Ob(6,25),T.Ac(7,ue,1,0,"mat-header-cell",26),T.Ac(8,ge,3,4,"mat-cell",27),T.Nb(),T.Ob(9,28),T.Ac(10,he,2,0,"mat-header-cell",26),T.Ac(11,Pe,3,2,"mat-cell",27),T.Nb(),T.Ob(12,29),T.Ac(13,ye,2,0,"mat-header-cell",26),T.Ac(14,ve,12,9,"mat-cell",30),T.Nb(),T.Ob(15,31),T.Ac(16,Ce,2,0,"mat-header-cell",32),T.Ac(17,Qe,9,8,"mat-cell",33),T.Nb(),T.Ac(18,$e,1,0,"mat-header-row",34),T.Ac(19,ke,1,0,"mat-row",35),T.Pb(),T.Pb()}if(2&e){const e=t.$implicit,a=T.cc();T.ic("expanded",e.key===a.expansionPanelOpen()),T.wb(3),T.Ec(" ",T.ec(4,5,e.key)," "),T.wb(2),T.ic("dataSource",e.value),T.wb(13),T.ic("matHeaderRowDef",a.displayedColumns),T.wb(1),T.ic("matRowDefColumns",a.displayedColumns)}}function Le(e,t){1&e&&(T.Qb(0,"span"),T.Cc(1,"\xa0[Unedited]"),T.Pb())}function Ae(e,t){if(1&e){const e=T.Rb();T.Ob(0),T.Qb(1,"mat-toolbar",45),T.Qb(2,"mat-toolbar-row"),T.Qb(3,"span"),T.Cc(4),T.Pb(),T.Ac(5,Le,2,0,"span",8),T.Qb(6,"button",46),T.Yb("click",(function(){T.rc(e);const t=T.cc().ngIf;return T.cc().openBuilderFromPreview(t)})),T.Cc(7," Edit it on builder "),T.Pb(),T.Pb(),T.Pb(),T.Lb(8,"ip-preview-template",47),T.Nb()}if(2&e){const e=T.cc().ngIf;T.wb(4),T.Dc(e.name),T.wb(1),T.ic("ngIf",!e.is_edited),T.wb(3),T.ic("template",e.html)}}function Ie(e,t){if(1&e){const e=T.Rb();T.Ob(0),T.Qb(1,"mat-toolbar",45),T.Qb(2,"mat-toolbar-row"),T.Qb(3,"span"),T.Cc(4),T.Pb(),T.Qb(5,"div",48),T.Qb(6,"button",49),T.Yb("click",(function(){return T.rc(e),T.cc(2).backdropClick()})),T.Cc(7," Close Builder "),T.Pb(),T.Pb(),T.Pb(),T.Pb(),T.Qb(8,"ip-email-builder",50),T.Qb(9,"div",51),T.Qb(10,"button",52),T.Yb("click",(function(){T.rc(e);const t=T.cc().ngIf;return T.cc().saveEmail(t)})),T.Cc(11," Save "),T.Pb(),T.Qb(12,"button",49),T.Yb("click",(function(){return T.rc(e),T.cc(2).revertTemplateBack()})),T.Cc(13," Revert Template "),T.Pb(),T.Pb(),T.Pb(),T.Nb()}if(2&e){const e=T.cc().ngIf;T.wb(4),T.Dc(e.name),T.wb(4),T.ic("email",e.template)}}function De(e,t){if(1&e&&(T.Ob(0),T.Ac(1,Ae,9,3,"ng-container",8),T.Ac(2,Ie,14,2,"ng-container",8),T.Nb()),2&e){const e=t.ngIf;T.wb(1),T.ic("ngIf",e.html),T.wb(1),T.ic("ngIf",e.template)}}function Se(){return Object(d.a)(e=>null!==e)}let Fe=(()=>{class e{constructor(e,t,a,r,d){this.res=e,this.ngb=t,this.dialog=a,this.snack=r,this.el=d,this.onDestroy$=new n.a,this.activeLanguage$=new i.a(globalThis.NGB.activeLanguage),this.previewTemplate$=new i.a(null),this.editTemplateObject$=new i.a(null),this.updatedStore=new Map,this.removeUpdatedStore=new Set,this.displayedColumns=["active","name","subject","actions"],this.pKey=globalThis.NGB.purchaseCode,this.baseUrl=globalThis.NGB.baseUrl,this.languages$=this.res.getAllLanguages().pipe(Object(m.a)(e=>this.getActiveLanguage$.pipe(Object(p.a)(t=>[...e,globalThis.NGB.activeLanguage].filter(e=>e!==t).sort())))),this.getActiveLanguage$=this.activeLanguage$.asObservable(),this.keyDowns$=Object(c.a)(this.el.nativeElement,"keydown").pipe(Object(u.a)(e=>{this.sidenav.opened&&e.stopImmediatePropagation()}),Object(g.a)(this.onDestroy$)),this.getTemplates$=this.getActiveLanguage$.pipe(Object(m.a)(e=>this.res.getTemplatesByLang(e)),Object(g.a)(this.onDestroy$)),this.getTemplateObject$=this.editTemplateObject$.pipe(y(o.a),Object(m.a)(e=>(this.pKey||this.snack.open("Please provide the purchase code before editing any templates.",null,{duration:1e4}),this.pKey&&e?Object(l.a)([this.res.getTemplate(e.id),this.res.getAllMergeFields(e.type)]).pipe(Object(p.a)(([t,a])=>(this.ngb.MergeTags=new Set(a.map(({key:e})=>e)),Object.assign(Object.assign({},e),{template:new Q.a(Object.assign({structures:[new Q.f("cols_1",[[new Q.g(t.template.message)]])]},t.template))}))),Object(u.a)(()=>{this.previewTemplate$.next(null),this.sidenav.open()})):Object(s.a)(null))),Object(g.a)(this.onDestroy$)),this.getPreviewTemplate$=this.previewTemplate$.pipe(y(o.a),Object(m.a)(e=>e?this.res.getTemplateBody(e.id).pipe(Object(p.a)(t=>Object.assign(Object.assign({},e),t)),Object(u.a)(()=>{this.editTemplateObject$.next(null),this.sidenav.open()})):Object(s.a)(null)),Object(g.a)(this.onDestroy$)),this.sidenavDetails$=Object(b.a)([this.getTemplateObject$,this.getPreviewTemplate$]).pipe(y(o.a),Object(p.a)(([e,t])=>e||t))}changeLanguage(e){this.activeLanguage$.next(e)}editTemplate(e,t){this.editTemplateObject$.next({id:e.emailtemplateid,type:t,name:e.name})}previewTemplate(e,t){this.previewTemplate$.next({id:e.emailtemplateid,type:t,name:e.name})}closeSidenav(e=!0){return Object(s.a)("").pipe(Object(v.a)(()=>e&&this.ngb.hasChanges?this.dialog.open(J,{data:{type:"confirm"},width:"300px",maxWidth:"100%"}).afterClosed().pipe(Object(p.a)(Boolean)):Object(s.a)(!0)),Object(u.a)(e=>e&&this.sidenav.close()))}backdropClick(){return this.closeSidenav().pipe(Object(C.a)(1)).subscribe(e=>{e&&(this.editTemplateObject$.next(null),this.previewTemplate$.next(null))})}getUpdatedDate(e){const{emailtemplateid:t}=e;return this.removeUpdatedStore.has(t)?null:this.updatedStore.get(t)||e.updated_at||null}openBuilderFromPreview({id:e,name:t,type:a}){return this.closeSidenav(!1).pipe(Object(C.a)(1)).subscribe(n=>{n&&this.editTemplateObject$.next({id:e,name:t,type:a})})}expansionPanelOpen(e){return e&&localStorage.setItem("expansionPanelOpened",e),localStorage.getItem("expansionPanelOpened")||"client"}saveEmail(e,t=!1){const a=new FormData;return this.editTemplateObject$.pipe(Se(),Object(m.a)(e=>(a.append("emailtemplateid",e.id),this.ngb.saveEmail().pipe(Object(m.a)(({html:e})=>(a.append("emailObject",JSON.stringify(this.ngb.Email)),a.append("template",e),this.res.sendPostRequest(a,"update"))),Object(x.a)(e=>(console.error(e),this.ngb.notify("Something bad happened."),r.a)),Object(j.a)(()=>this.updatedStore.set(e.id,new Date))))),Object(m.a)(({success:e})=>e&&t?this.closeSidenav(!1):Object(s.a)(e)),Object(C.a)(1)).subscribe(t=>{t&&(e.isEdited=!0,this.ngb.notify("Email template has been saved successfully."))})}changeActiveStatus({checked:e,source:t},a){const n=e?1:0,i=new FormData;return i.append("emailtemplateid",a.emailtemplateid),i.append("active",String(n)),this.res.sendPostRequest(i,"changeActiveStatus").pipe(Object(x.a)(()=>(t.toggle(),r.a)),Object(C.a)(1)).subscribe(({success:e})=>{e?(a.active=n,this.updatedStore.set(a.emailtemplateid,new Date)):t.toggle()})}changeElementDetails(e,t){return this.res.getAllMergeFields(t).pipe(Object(v.a)(t=>this.dialog.open(J,{data:{type:"edit",data:e,mergeFields:t},width:"450px",maxWidth:"100%"}).afterClosed()),Object(m.a)(e=>{if(!e)return Object(s.a)({success:!1,updates:null});const t=new FormData(e);return this.res.sendPostRequest(t,"updateDetails")})).subscribe(({success:t,updates:a})=>{t&&a&&(e.subject=a.subject,e.fromname=a.fromname,this.updatedStore.set(e.emailtemplateid,new Date),this.ngb.notify("The details have been saved."))})}revertTemplateBack(){return this.editTemplateObject$.pipe(Se(),Object(v.a)(({id:e})=>this.dialog.open(J,{data:{type:"confirm-revert"},width:"300px",maxWidth:"100%"}).afterClosed().pipe(Object(p.a)(Boolean),Object(d.a)(e=>e),Object(m.a)(()=>this.res.revertTemplate(e).pipe(Object(j.a)(()=>{this.updatedStore.delete(e),this.removeUpdatedStore.add(e)}))))),Object(C.a)(1)).subscribe(({email:e})=>{this.ngb.Email=e})}ngOnInit(){this.keyDowns$.subscribe()}ngOnDestroy(){this.onDestroy$.next(!0),this.onDestroy$.complete(),this.activeLanguage$.complete(),this.previewTemplate$.complete(),this.editTemplateObject$.complete(),this.updatedStore.clear(),this.removeUpdatedStore.clear()}}return e.\u0275fac=function(t){return new(t||e)(T.Kb(I),T.Kb(Q.d),T.Kb(D.b),T.Kb(A.a),T.Kb(T.j))},e.\u0275cmp=T.Eb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var a;1&e&&T.Gc(se,!0),2&e&&T.nc(a=T.Zb())&&(t.sidenav=a.first)},decls:29,vars:22,consts:[[2,"width","100%",3,"backdropClick"],["fxLayout","column wrap","fxLayoutAlign","top center","fxLayoutGap","1rem",1,"mat-typography"],[1,"mat-elevation-z2"],["mode","indeterminate","style","position: absolute;",4,"ngIf"],["fxLayout","","fxLayoutGap","1rem",2,"margin-left","auto"],["mat-flat-button","","color","primary","class","capitalize",4,"ngIf"],["mat-flat-button","",3,"matMenuTriggerFor","disabled"],["langMenu","matMenu"],[4,"ngIf"],["fxLayout","column","fxLayoutGap","1rem",2,"padding","1rem","max-width","1400px","width","100%","box-sizing","border-box"],["class","alert alert-danger","fxFlex","",4,"ngIf"],["fxFlex",""],[3,"expanded","opened",4,"ngFor","ngForOf"],["position","end","disableClose","",2,"width","1200px","max-width","80%"],["sidenav",""],["mode","indeterminate",2,"position","absolute"],["mat-flat-button","","color","primary",1,"capitalize"],["matMenuContent",""],[4,"ngFor","ngForOf"],["mat-menu-item","",1,"capitalize",3,"click"],["fxFlex","",1,"alert","alert-danger"],[3,"href"],[3,"expanded","opened"],[1,"capitalize"],["fxFlex","",3,"dataSource"],["matColumnDef","active"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","name"],["matColumnDef","subject"],["class","subject-column","fxLayoutAlign","space-between center",4,"matCellDef"],["matColumnDef","actions"],["fxFlex","0 0 144px","fxLayoutAlign","flex-end center",4,"matHeaderCellDef"],["fxLayoutAlign","flex-end","fxFlex","0 0 auto",4,"matCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["matTooltip","Change active status","matTooltipPosition","above","disableRipple","",3,"checked","disabled","change"],["fxLayoutAlign","space-between center",1,"subject-column"],["fxLayout","","fxLayoutAlign","center center","fxLayoutGap","0.5rem"],["matTooltip","Last updated","matTooltipPosition","above"],["mat-icon-button","","matTooltip","Edit email details","matTooltipPosition","left","aria-label","Edit email details","color","primary",3,"disabled","click"],["fxFlex","0 0 144px","fxLayoutAlign","flex-end center"],["fxLayoutAlign","flex-end","fxFlex","0 0 auto"],["mat-icon-button","","matTooltip","Open on builder","matTooltipPosition","above","aria-label","Open on builder","color","accent",3,"disabled","click"],["mat-icon-button","","matTooltip","Preview","matTooltipPosition","above","aria-label","Preview","color","accent",3,"disabled","click"],["color","primary"],["mat-flat-button","","color","accent",2,"margin-left","auto",3,"click"],[2,"height","100%","justify-content","center",3,"template"],["fxLayoutGap","0.5rem",2,"margin-left","auto"],["mat-flat-button","","color","accent",3,"click"],[2,"height","inherit",3,"email"],["fxLayoutGap","0.5rem",1,"top-actions"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,t){if(1&e&&(T.Qb(0,"mat-sidenav-container",0),T.Yb("backdropClick",(function(){return t.backdropClick()})),T.Qb(1,"mat-sidenav-content"),T.Qb(2,"div",1),T.Qb(3,"mat-toolbar",2),T.Ac(4,le,1,0,"mat-progress-bar",3),T.dc(5,"async"),T.Qb(6,"mat-toolbar-row"),T.Qb(7,"h1"),T.Cc(8,"Email templates"),T.Pb(),T.Qb(9,"div",4),T.Ac(10,be,2,1,"button",5),T.dc(11,"async"),T.Qb(12,"button",6),T.dc(13,"async"),T.Cc(14," Other languages "),T.Pb(),T.Qb(15,"mat-menu",null,7),T.Ac(17,me,1,0,void 0,8),T.dc(18,"async"),T.Pb(),T.Pb(),T.Pb(),T.Pb(),T.Qb(19,"div",9),T.Ac(20,pe,5,1,"div",10),T.Qb(21,"mat-accordion",11),T.Ac(22,Te,20,7,"mat-expansion-panel",12),T.dc(23,"keyvalue"),T.dc(24,"async"),T.Pb(),T.Pb(),T.Pb(),T.Pb(),T.Qb(25,"mat-sidenav",13,14),T.Ac(27,De,3,2,"ng-container",8),T.dc(28,"async"),T.Pb(),T.Pb()),2&e){const e=T.oc(16);T.wb(4),T.ic("ngIf",T.ec(5,8,t.res.isLoading$)),T.wb(6),T.ic("ngIf",T.ec(11,10,t.getActiveLanguage$)),T.wb(2),T.ic("matMenuTriggerFor",e)("disabled",T.ec(13,12,t.res.isLoading$)),T.wb(5),T.ic("ngIf",T.ec(18,14,t.languages$)),T.wb(3),T.ic("ngIf",!t.pKey),T.wb(2),T.ic("ngForOf",T.ec(23,16,T.ec(24,18,t.getTemplates$))),T.wb(5),T.ic("ngIf",T.ec(28,20,t.sidenavDetails$))}},directives:[V.b,V.c,F.c,F.b,F.d,W.a,S.i,W.c,M.a,Z.d,Z.e,ee.a,F.a,S.h,V.a,te.a,Z.a,Z.b,ee.c,ee.e,ee.f,ae.j,ae.c,ae.e,ae.b,ae.g,ae.i,ae.d,ae.a,ne.a,ie.a,ce.a,ae.f,ae.h,Q.e,Q.b],pipes:[S.a,S.e,oe,S.d],styles:["[_nghost-%COMP%]{display:block;height:inherit}[_nghost-%COMP%], mat-sidenav-container[_ngcontent-%COMP%]{min-height:inherit}mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:first-child{max-width:84px}mat-cell[_ngcontent-%COMP%]:first-child{max-width:-webkit-fit-content;max-width:-moz-fit-content;max-width:fit-content;padding-right:24px}mat-cell[_ngcontent-%COMP%]:nth-child(2), mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:nth-child(2){max-width:400px;border-right:1px solid #e0e0e0}mat-cell[_ngcontent-%COMP%]:nth-child(3), mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:nth-child(3){padding-left:24px}.subject-column[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{opacity:0;transition:all .3s ease-in-out;will-change:opacity}.subject-column[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:1}.subject-column[_ngcontent-%COMP%]:hover   button[_ngcontent-%COMP%]:not(:hover){opacity:.5}.mat-drawer-container[_ngcontent-%COMP%]{background:transparent;height:inherit}.force-select[_ngcontent-%COMP%]{-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all;margin-bottom:1rem}"],changeDetection:0}),e})()}}]);