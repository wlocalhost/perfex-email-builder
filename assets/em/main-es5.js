function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],a=!0,i=!1,c=void 0;try{for(var o,r=e[Symbol.iterator]();!(a=(o=r.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(s){i=!0,c=s}finally{try{a||null==r.return||r.return()}finally{if(i)throw c}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(e,t,n){e.exports=n("zUnb")},crnd:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="crnd"},zUnb:function(e,t,n){"use strict";n.r(t);var a=n("fXoL");window;var i=n("XNiG"),c=n("2Vo4"),o=n("z6cu"),r=n("JIr8"),s=n("vkgz"),l=n("nYR2"),b=n("1G5W"),u=n("lJxs"),m=n("uSps");function p(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var i=n[a];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null}var d,f,g=n("tk/3"),h=n("dNgK"),v=((f=function(){function e(t,n){_classCallCheck(this,e),this.http=t,this.matSnack=n,this.onDestroy$=new i.a,this.isLoading$=new c.a(!1)}return _createClass(e,[{key:"httpRequest",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"get",i=arguments.length>3?arguments[3]:void 0;return this.isLoading$.next(!0),this.matSnack.open("Please wait..."),this.http.request(a,"".concat(this.apiBase,"/").concat(e),{params:n,body:i,responseType:"json"}).pipe(Object(r.a)((function(e){return e.error instanceof ErrorEvent?console.error("An error occurred:",e.error.message):(console.error("Backend returned code ".concat(e.status)),t.matSnack.open('Something bad happened; please try again later. If error persist, contact me at support@wlocalhost.org and include this message: "Error Status '.concat(e.status,'".'),"Close",{announcementMessage:"Something bad happened; please try again later."})),Object(o.a)("Something bad happened; please try again later.")})),Object(s.a)((function(){return t.matSnack.dismiss()})),Object(l.a)((function(){return t.isLoading$.next(!1)})),Object(b.a)(this.onDestroy$))}},{key:"init",value:function(e,t,n){this.apiBase=e,this.csrfName=t,this.csrfToken=p("csrf_cookie_name")||n}},{key:"getTemplatesByLang",value:function(e){return this.httpRequest("templates",{language:e})}},{key:"getTemplateBody",value:function(e){return this.httpRequest("getEmailTemplate",{emailtemplateid:e})}},{key:"getTemplate",value:function(e){return this.httpRequest("getTemplate",{emailtemplateid:e}).pipe(Object(u.a)((function(e){return{isEdited:!!e.emailObject,email:new m.a(e.emailObject||{structures:[new m.g("cols_1",[[new m.h(e.message)]])]})}})))}},{key:"revertTemplate",value:function(e){return this.sendPostRequest(new FormData,"revertTemplate/".concat(e)).pipe(Object(u.a)((function(e){return{isEdited:!1,email:new m.a({structures:[new m.g("cols_1",[[new m.h(e.message)]])]})}})))}},{key:"sendPostRequest",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new FormData,t=arguments.length>1?arguments[1]:void 0;return e.append(this.csrfName,this.csrfToken),this.httpRequest(t,{},"post",e)}},{key:"ngOnDestroy",value:function(){this.onDestroy$.next(!0),this.onDestroy$.complete(),this.isLoading$.next(!1),this.isLoading$.complete()}}]),e}()).\u0275fac=function(e){return new(e||f)(a.Ub(g.a),a.Ub(h.a))},f.\u0275prov=a.Gb({token:f,factory:f.\u0275fac,providedIn:"root"}),f),y=((d=function e(){_classCallCheck(this,e),this.templatesCache=new Map}).\u0275fac=function(e){return new(e||d)},d.\u0275prov=a.Gb({token:d,factory:d.\u0275fac,providedIn:"root"}),d),w=n("ofXK"),P=n("mrSG"),C=n("itXk"),k=n("xgIS"),O=n("LRne"),x=n("EY2u"),Q=n("XqQ8"),j=n("0IaG"),$=n("XiUz"),A=n("bTqV"),_=n("3Pt+"),L=n("kmnG"),T=n("qFsG"),I=n("MutI"),D=n("f0Cb");function S(e,t){1&e&&(a.Ob(0),a.Qb(1,"h2",2),a.Cc(2,"Are you sure?"),a.Pb(),a.Qb(3,"mat-dialog-content"),a.Cc(4," You are about to close the builder, but there're unsaved changes, which will be lost. Are you sure? "),a.Pb(),a.Qb(5,"mat-dialog-actions",3),a.Qb(6,"button",4),a.Cc(7," No, Go back! "),a.Pb(),a.Qb(8,"button",5),a.Cc(9," Yes, Close it. "),a.Pb(),a.Pb(),a.Nb()),2&e&&(a.wb(8),a.ic("mat-dialog-close",!0))}function F(e,t){1&e&&(a.Ob(0),a.Qb(1,"h2",2),a.Cc(2,"Are you sure?"),a.Pb(),a.Qb(3,"mat-dialog-content"),a.Qb(4,"p"),a.Cc(5,"You are about to restore this template to default Perfex template, all additional changes will be lost."),a.Pb(),a.Qb(6,"p"),a.Qb(7,"strong"),a.Qb(8,"strong"),a.Cc(9,"This will affect only template body, not name nor subject."),a.Pb(),a.Pb(),a.Pb(),a.Qb(10,"p"),a.Qb(11,"strong"),a.Cc(12,"Are you sure?"),a.Pb(),a.Pb(),a.Pb(),a.Qb(13,"mat-dialog-actions",3),a.Qb(14,"button",4),a.Cc(15," No, Go back! "),a.Pb(),a.Qb(16,"button",5),a.Cc(17," Yes, Restore it. "),a.Pb(),a.Pb(),a.Nb()),2&e&&(a.wb(16),a.ic("mat-dialog-close",!0))}function E(e,t){if(1&e&&(a.Qb(0,"mat-list-item"),a.Qb(1,"div",16),a.Qb(2,"span"),a.Cc(3),a.Pb(),a.Qb(4,"code"),a.Cc(5),a.Pb(),a.Pb(),a.Pb()),2&e){var n=a.cc().$implicit;a.wb(3),a.Dc(n.name),a.wb(2),a.Dc(n.key)}}function R(e,t){1&e&&a.Lb(0,"mat-divider")}function M(e,t){if(1&e&&(a.Ob(0),a.Ac(1,E,6,2,"mat-list-item",1),a.Ac(2,R,1,0,"mat-divider",1),a.Nb()),2&e){var n=t.$implicit;a.wb(1),a.ic("ngIf",n.key),a.wb(1),a.ic("ngIf",n.key)}}function N(e,t){if(1&e&&(a.Qb(0,"mat-list",14),a.Ac(1,M,3,2,"ng-container",15),a.Pb()),2&e){var n=a.cc(2);a.wb(1),a.ic("ngForOf",n.data.mergeFields)}}function B(e,t){if(1&e&&(a.Ob(0),a.Qb(1,"h2",2),a.Cc(2,"Edit details"),a.Pb(),a.Qb(3,"mat-dialog-content"),a.Qb(4,"form",null,6),a.Lb(6,"input",7),a.Qb(7,"mat-form-field",8),a.Qb(8,"mat-label"),a.Cc(9,"From Name"),a.Pb(),a.Lb(10,"input",9),a.Pb(),a.Qb(11,"mat-form-field",8),a.Qb(12,"mat-label"),a.Cc(13,"Subject"),a.Pb(),a.Lb(14,"input",10),a.Pb(),a.Pb(),a.Ac(15,N,2,1,"mat-list",11),a.Pb(),a.Qb(16,"mat-dialog-actions",3),a.Qb(17,"button",12),a.Cc(18," Cancel "),a.Pb(),a.Qb(19,"button",13),a.Cc(20," Save "),a.Pb(),a.Pb(),a.Nb()),2&e){var n=a.oc(5),i=a.cc();a.wb(6),a.ic("value",i.data.data.emailtemplateid),a.wb(4),a.ic("value",i.data.data.fromname),a.wb(4),a.ic("value",i.data.data.subject),a.wb(1),a.ic("ngIf",i.data.mergeFields),a.wb(4),a.ic("disabled",!i.checkValidity(n))("mat-dialog-close",n)}}function Y(e,t){if(1&e&&(a.Ob(0),a.Qb(1,"h2",2),a.Cc(2,"Send test email"),a.Pb(),a.Qb(3,"mat-dialog-content"),a.Lb(4,"form",null,17),a.Pb(),a.Qb(6,"mat-dialog-actions",3),a.Qb(7,"button",4),a.Cc(8," No, Go back! "),a.Pb(),a.Qb(9,"button",5),a.Cc(10," Yes, Close it. "),a.Pb(),a.Pb(),a.Nb()),2&e){var n=a.oc(5);a.wb(9),a.ic("mat-dialog-close",n)}}var q,z,G=((q=function(){function e(t){_classCallCheck(this,e),this.data=t}return _createClass(e,[{key:"checkValidity",value:function(e){return e.checkValidity()}}]),e}()).\u0275fac=function(e){return new(e||q)(a.Kb(j.a))},q.\u0275cmp=a.Eb({type:q,selectors:[["app-modal-dialog"]],decls:5,vars:4,consts:[[1,"mat-typography"],[4,"ngIf"],["mat-dialog-title",""],["fxLayoutAlign","space-between center"],["mat-button","","color","warn","cdkFocusInitial","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["form",""],["type","hidden","name","emailtemplateid",3,"value"],["appearance","fill"],["matInput","","name","fromname","required","","type","text",3,"value"],["matInput","","name","subject","required","","type","text",3,"value"],["dense","",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary","cdkFocusInitial","",3,"disabled","mat-dialog-close"],["dense",""],[4,"ngFor","ngForOf"],["fxFlex","","fxLayout","","fxLayoutAlign","space-between center"],["form","ngForm"]],template:function(e,t){1&e&&(a.Qb(0,"div",0),a.Ac(1,S,10,1,"ng-container",1),a.Ac(2,F,18,1,"ng-container",1),a.Ac(3,B,21,6,"ng-container",1),a.Ac(4,Y,11,1,"ng-container",1),a.Pb()),2&e&&(a.wb(1),a.ic("ngIf","confirm"===t.data.type),a.wb(1),a.ic("ngIf","confirm-revert"===t.data.type),a.wb(1),a.ic("ngIf","edit"===t.data.type),a.wb(1),a.ic("ngIf","test-email"===t.data.type))},directives:[w.i,j.h,j.e,j.c,$.b,A.a,j.d,_.o,_.i,_.j,L.a,L.e,T.a,I.a,w.h,I.c,$.a,$.c,D.a],styles:["[_nghost-%COMP%]{display:block}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;height:auto}mat-list[_ngcontent-%COMP%]{max-height:300px;overflow:auto}mat-list[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all}"]}),q),H=n("XhcP"),K=n("/t3+"),U=n("STbY"),J=n("7EHt"),V=n("bv9b"),W=n("+0xr"),X=n("1jcm"),Z=n("Qu3c"),ee=n("NFeN"),te=((z=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e){return e.split("_").join(" ")}}]),e}()).\u0275fac=function(e){return new(e||z)},z.\u0275pipe=a.Jb({name:"keyToLang",type:z,pure:!0}),z);function ne(e,t){1&e&&a.Lb(0,"mat-progress-bar",15)}function ae(e,t){if(1&e&&(a.Qb(0,"button",16),a.Cc(1),a.dc(2,"async"),a.Pb()),2&e){var n=a.cc();a.wb(1),a.Ec(" ",a.ec(2,1,n.getActiveLanguage$)," ")}}function ie(e,t){if(1&e){var n=a.Rb();a.Qb(0,"button",19),a.Yb("click",(function(){a.rc(n);var e=a.cc().$implicit;return a.cc(2).activeLanguage$.next(e)})),a.Cc(1),a.dc(2,"keyToLang"),a.Pb()}if(2&e){var i=a.cc().$implicit;a.wb(1),a.Ec(" ",a.ec(2,1,i)," ")}}function ce(e,t){if(1&e&&(a.Ob(0),a.Ac(1,ie,3,3,"button",18),a.dc(2,"async"),a.Nb()),2&e){var n=t.$implicit,i=a.cc(2);a.wb(1),a.ic("ngIf",a.ec(2,1,i.getActiveLanguage$)!==n)}}function oe(e,t){if(1&e&&a.Ac(0,ce,3,3,"ng-container",17),2&e){var n=a.cc();a.ic("ngForOf",n.app.languages)}}function re(e,t){1&e&&a.Lb(0,"mat-header-cell")}function se(e,t){if(1&e){var n=a.Rb();a.Qb(0,"mat-cell"),a.Qb(1,"mat-slide-toggle",34),a.Yb("change",(function(e){a.rc(n);var i=t.$implicit;return a.cc(2).changeActiveStatus(e,i)})),a.dc(2,"async"),a.Pb(),a.Pb()}if(2&e){var i=t.$implicit,c=a.cc(2);a.wb(1),a.ic("checked",i.active-0==1)("disabled",a.ec(2,2,c.res.isLoading$))}}function le(e,t){1&e&&(a.Qb(0,"mat-header-cell"),a.Cc(1,"Name"),a.Pb())}function be(e,t){if(1&e&&(a.Qb(0,"span"),a.Cc(1),a.Pb()),2&e){var n=a.cc().$implicit;a.wb(1),a.Dc(n.name)}}function ue(e,t){if(1&e&&(a.Qb(0,"del"),a.Cc(1),a.Pb()),2&e){var n=a.cc().$implicit;a.wb(1),a.Dc(n.name)}}function me(e,t){if(1&e&&(a.Qb(0,"mat-cell"),a.Ac(1,be,2,1,"span",14),a.Ac(2,ue,2,1,"del",14),a.Pb()),2&e){var n=t.$implicit;a.wb(1),a.ic("ngIf","1"===n.active),a.wb(1),a.ic("ngIf","1"!==n.active)}}function pe(e,t){1&e&&(a.Qb(0,"mat-header-cell"),a.Cc(1," From Name > Subject "),a.Pb())}function de(e,t){if(1&e&&(a.Qb(0,"span"),a.Cc(1),a.Pb()),2&e){var n=a.cc().$implicit;a.wb(1),a.Ec(" ",n.fromname," > ")}}function fe(e,t){if(1&e&&(a.Qb(0,"span"),a.Cc(1),a.dc(2,"date"),a.Pb()),2&e){var n=a.cc().$implicit;a.wb(1),a.Dc(a.fc(2,1,n.updated_at,"short"))}}function ge(e,t){1&e&&(a.Qb(0,"span"),a.Cc(1,"-"),a.Pb())}function he(e,t){if(1&e){var n=a.Rb();a.Qb(0,"mat-cell",35),a.Qb(1,"div"),a.Ac(2,de,2,1,"span",14),a.Cc(3),a.Pb(),a.Qb(4,"div",36),a.Qb(5,"span",37),a.Ac(6,fe,3,4,"span",14),a.Ac(7,ge,2,0,"span",14),a.Pb(),a.Qb(8,"button",38),a.Yb("click",(function(){a.rc(n);var e=t.$implicit,i=a.cc().$implicit;return a.cc().changeElementDetails(e,i.key)})),a.dc(9,"async"),a.Qb(10,"mat-icon"),a.Cc(11,"edit"),a.Pb(),a.Pb(),a.Pb(),a.Pb()}if(2&e){var i=t.$implicit,c=a.cc(2);a.wb(2),a.ic("ngIf",i.fromname),a.wb(1),a.Ec(" ",i.subject," "),a.wb(3),a.ic("ngIf",i.updated_at),a.wb(1),a.ic("ngIf",!i.updated_at),a.wb(1),a.ic("disabled",a.ec(9,5,c.res.isLoading$))}}function ve(e,t){1&e&&(a.Qb(0,"mat-header-cell",39),a.Cc(1," Actions "),a.Pb())}function ye(e,t){1&e&&(a.Qb(0,"mat-icon"),a.Cc(1," visibility "),a.Pb())}function we(e,t){1&e&&(a.Qb(0,"mat-icon"),a.Cc(1," visibility_off "),a.Pb())}function Pe(e,t){if(1&e){var n=a.Rb();a.Qb(0,"mat-cell",40),a.Qb(1,"button",41),a.Yb("click",(function(){a.rc(n);var e=t.$implicit;return a.cc(2).editTemplate$.next(e)})),a.dc(2,"async"),a.Qb(3,"mat-icon"),a.Cc(4,"dashboard"),a.Pb(),a.Pb(),a.Qb(5,"button",42),a.Yb("click",(function(){a.rc(n);var e=t.$implicit,i=a.cc().$implicit;return a.cc().previewTemplate$.next({id:e.emailtemplateid,type:i.key,name:e.name})})),a.dc(6,"async"),a.Ac(7,ye,2,0,"mat-icon",14),a.Ac(8,we,2,0,"mat-icon",14),a.Pb(),a.Pb()}if(2&e){var i=t.$implicit,c=a.cc(2);a.wb(1),a.ic("disabled",a.ec(2,4,c.res.isLoading$)),a.wb(4),a.ic("disabled",a.ec(6,6,c.res.isLoading$)),a.wb(2),a.ic("ngIf",i.active-0==1),a.wb(1),a.ic("ngIf",i.active-0==0)}}function Ce(e,t){1&e&&a.Lb(0,"mat-header-row")}function ke(e,t){1&e&&a.Lb(0,"mat-row")}function Oe(e,t){if(1&e){var n=a.Rb();a.Qb(0,"mat-expansion-panel",20),a.Yb("opened",(function(){a.rc(n);var e=t.$implicit;return a.cc().expansionPanelOpen(e.key)})),a.Qb(1,"mat-expansion-panel-header"),a.Qb(2,"mat-panel-title",21),a.Cc(3),a.dc(4,"keyToLang"),a.Pb(),a.Pb(),a.Qb(5,"mat-table",22),a.Ob(6,23),a.Ac(7,re,1,0,"mat-header-cell",24),a.Ac(8,se,3,4,"mat-cell",25),a.Nb(),a.Ob(9,26),a.Ac(10,le,2,0,"mat-header-cell",24),a.Ac(11,me,3,2,"mat-cell",25),a.Nb(),a.Ob(12,27),a.Ac(13,pe,2,0,"mat-header-cell",24),a.Ac(14,he,12,7,"mat-cell",28),a.Nb(),a.Ob(15,29),a.Ac(16,ve,2,0,"mat-header-cell",30),a.Ac(17,Pe,9,8,"mat-cell",31),a.Nb(),a.Ac(18,Ce,1,0,"mat-header-row",32),a.Ac(19,ke,1,0,"mat-row",33),a.Pb(),a.Pb()}if(2&e){var i=t.$implicit,c=a.cc();a.ic("expanded",i.key===c.expansionPanelOpen()),a.wb(3),a.Ec(" ",a.ec(4,5,i.key)," "),a.wb(2),a.ic("dataSource",i.value),a.wb(13),a.ic("matHeaderRowDef",c.displayedColumns),a.wb(1),a.ic("matRowDefColumns",c.displayedColumns)}}function xe(e,t){1&e&&(a.Qb(0,"span"),a.Cc(1,"\xa0[Unedited]"),a.Pb())}function Qe(e,t){if(1&e){var n=a.Rb();a.Ob(0),a.Qb(1,"mat-toolbar",43),a.Qb(2,"mat-toolbar-row"),a.Qb(3,"span"),a.Cc(4),a.Pb(),a.Ac(5,xe,2,0,"span",14),a.Qb(6,"button",44),a.Yb("click",(function(){a.rc(n);var e=t.ngIf;return a.cc().openBuilderFromPreview(e)})),a.Cc(7," Edit it on builder "),a.Pb(),a.Pb(),a.Pb(),a.Lb(8,"ip-preview-template",45),a.Nb()}if(2&e){var i=t.ngIf;a.wb(4),a.Dc(i.name),a.wb(1),a.ic("ngIf",!i.is_edited),a.wb(3),a.ic("template",i.html)}}function je(e,t){if(1&e){var n=a.Rb();a.Ob(0),a.Qb(1,"mat-toolbar",43),a.Qb(2,"mat-toolbar-row"),a.Qb(3,"span"),a.Cc(4),a.Pb(),a.Qb(5,"div",46),a.Qb(6,"button",47),a.Yb("click",(function(){a.rc(n);var e=t.ngIf;return a.cc().saveEmail(e)})),a.Cc(7," Save "),a.Pb(),a.Qb(8,"button",47),a.Yb("click",(function(){a.rc(n);var e=t.ngIf;return a.cc().saveEmail(e,!0)})),a.Cc(9," Save and Close "),a.Pb(),a.Pb(),a.Pb(),a.Pb(),a.Qb(10,"ip-email-builder",48),a.Qb(11,"div",49),a.Qb(12,"button",47),a.Yb("click",(function(){a.rc(n);var e=t.ngIf;return a.cc().revertTemplateBack(e.isEdited)})),a.Cc(13," Restore template "),a.Pb(),a.Pb(),a.Pb(),a.Nb()}if(2&e){var i=t.ngIf;a.wb(4),a.Dc(i.name),a.wb(6),a.ic("email",i.email)}}var $e,Ae,_e=((Ae=function(){function e(t,n,a,o,r){var l=this;_classCallCheck(this,e),this.res=t,this.ngb=n,this.app=a,this.dialog=o,this.el=r,this.onDestroy$=new i.a,this.displayedColumns=["active","name","subject","actions"],this.activeLanguage$=new c.a(null),this.getActiveLanguage$=this.activeLanguage$.pipe(Object(u.a)((function(e){return e||l.app.activeLanguage})),Object(b.a)(this.onDestroy$)),this.previewTemplate$=new c.a(null),this.editTemplate$=new c.a(null),this.openSidenav$=new i.a,this.keyDowns$=Object(C.a)([this.openSidenav$,Object(k.a)(this.el.nativeElement,"keydown")]).pipe(Object(s.a)((function(e){var t=_slicedToArray(e,2),n=t[0],a=t[1];n&&a.stopImmediatePropagation()})),Object(b.a)(this.onDestroy$)),this.getTemplates$=this.getActiveLanguage$.pipe(Object(Q.a)((function(e){return l.app.templatesCache.has(e)?Object(O.a)(l.app.templatesCache.get(e)):l.res.getTemplatesByLang(e).pipe(Object(s.a)((function(t){return l.app.templatesCache.set(e,t)})))})),Object(b.a)(this.onDestroy$)),this.getTemplate$=this.editTemplate$.pipe(Object(Q.a)((function(e){return e?e.email?Object(O.a)(e):l.res.getTemplate(e.emailtemplateid).pipe(Object(u.a)((function(t){return Object.assign(Object.assign({},e),t)}))):Object(O.a)(null)})),Object(s.a)((function(e){e&&(l.ngb.MergeTags=new Set(_toConsumableArray(l.app.mergeFields.filter((function(t){return t.type===e.type})).map((function(e){return e.key})))))})),Object(s.a)((function(e){return requestAnimationFrame((function(){return l.openSidenav$.next(!!e)}))})),Object(b.a)(this.onDestroy$)),this.getTemplateBody$=this.previewTemplate$.pipe(Object(Q.a)((function(e){return e&&l.res.getTemplateBody(e.id).pipe(Object(u.a)((function(t){return Object.assign(Object.assign({},t),e)})),Object(s.a)((function(e){return requestAnimationFrame((function(){return l.openSidenav$.next(!!e)}))})))||Object(O.a)(null)})),Object(b.a)(this.onDestroy$))}return _createClass(e,[{key:"closeSidenav",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Object(P.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!0,t.t0=e&&this.ngb.hasChanges&&this.editTemplate$.getValue(),!t.t0){t.next=6;break}return t.next=5,this.dialog.open(G,{data:{type:"confirm"},width:"300px",maxWidth:"100%"}).afterClosed().pipe(Object(u.a)(Boolean)).toPromise();case 5:n=t.sent;case 6:n&&this.editTemplate$.next(null),this.previewTemplate$.next(null),requestAnimationFrame((function(){return a.openSidenav$.next(!n)}));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"openBuilderFromPreview",value:function(e){var t=e.id,n=e.type,a=e.name;return Object(P.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.previewTemplate$.next(null),e.next=3,this.closeSidenav();case 3:requestAnimationFrame((function(){return i.editTemplate$.next({emailtemplateid:t,type:n,name:a})}));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"expansionPanelOpen",value:function(e){return e&&localStorage.setItem("expansionPanelOpened",e),localStorage.getItem("expansionPanelOpened")||"client"}},{key:"saveEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(P.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a,i,c,o,r,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=!0,!this.ngb.hasChanges){n.next=23;break}return n.prev=2,n.next=5,this.ngb.saveEmail();case 5:return i=n.sent,c=i.email,o=i.template,r=new FormData,s=this.editTemplate$.getValue(),r.append("emailtemplateid",s.emailtemplateid),r.append("emailObject",JSON.stringify(c)),r.append("template",o),n.next=15,this.res.sendPostRequest(r,"update").toPromise();case 15:a=n.sent.success,e.isEdited=!0,s.updated_at=new Date,n.next=23;break;case 20:n.prev=20,n.t0=n.catch(2),a=!1,console.error(n.t0),this.ngb.snackBar.open("Something bad happened.","Close");case 23:if(n.t1=t&&a,!n.t1){n.next=27;break}return n.next=27,this.closeSidenav();case 27:a&&this.ngb.snackBar.open("Email template has been saved successfully.",null,{duration:3e3});case 28:case"end":return n.stop()}}),n,this,[[2,20]])})))}},{key:"changeActiveStatus",value:function(e,t){var n=e.checked,a=e.source;return Object(P.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n?1:0,(c=new FormData).append("emailtemplateid",t.emailtemplateid),c.append("active",String(i)),e.prev=2,e.next=5,this.res.sendPostRequest(c,"changeActiveStatus").toPromise();case 5:if(!e.sent.success){e.next=9;break}t.active=i,t.updated_at=new Date,e.next=10;break;case 9:a.toggle();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),a.toggle();case 15:case"end":return e.stop()}}),e,this,[[2,12]])})))}},{key:"changeElementDetails",value:function(e,t){return Object(P.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a,i=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.dialog.open(G,{data:{type:"edit",data:e,mergeFields:this.app.mergeFields.filter((function(e){return t===e.type}))},width:"450px",maxWidth:"100%"}).afterClosed().pipe(Object(Q.a)((function(e){if(!e)return Object(O.a)({success:!1});var t=new FormData(e);return i.res.sendPostRequest(t,"updateDetails")}))).toPromise();case 2:(a=n.sent).success&&(e.subject=a.updates.subject,e.fromname=a.updates.fromname,e.updated_at=new Date,this.ngb.snackBar.open("The details have been saved.",null,{duration:3e3}));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"revertTemplateBack",value:function(e){return Object(P.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e?(n=this.editTemplate$.getValue(),this.dialog.open(G,{data:{type:"confirm-revert"},width:"300px",maxWidth:"100%"}).afterClosed().pipe(Object(u.a)(Boolean),Object(Q.a)((function(e){return e&&a.res.revertTemplate(n.emailtemplateid)||x.a})),Object(s.a)((function(e){return a.ngb.Email=e.email})),Object(s.a)((function(){return delete n.updated_at}))).toPromise()):this.ngb.snackBar.open("You can't restore this tempalte, as it's not edited.",null,{duration:3e3});case 1:case"end":return t.stop()}}),t,this)})))}},{key:"ngOnInit",value:function(){this.keyDowns$.subscribe(),console.log(this.el.nativeElement)}},{key:"ngOnDestroy",value:function(){this.onDestroy$.next(!0),this.onDestroy$.complete(),this.activeLanguage$.complete(),this.previewTemplate$.complete(),this.editTemplate$.complete(),this.openSidenav$.complete()}}]),e}()).\u0275fac=function(e){return new(e||Ae)(a.Kb(v),a.Kb(m.e),a.Kb(y),a.Kb(j.b),a.Kb(a.j))},Ae.\u0275cmp=a.Eb({type:Ae,selectors:[["app-templates"]],decls:31,vars:25,consts:[[2,"width","100%",3,"backdropClick"],["fxLayout","column wrap","fxLayoutAlign","top center","fxLayoutGap","1rem",1,"mat-typography"],[1,"mat-elevation-z2"],["mode","indeterminate","style","position: absolute;",4,"ngIf"],["fxLayout","","fxLayoutGap","1rem",2,"margin-left","auto"],["mat-flat-button","","color","primary",1,"capitalize",3,"click"],["mat-stroked-button","","color","primary","class","capitalize",4,"ngIf"],["mat-flat-button","",3,"matMenuTriggerFor","disabled"],["langMenu","matMenu"],["matMenuContent",""],[2,"padding","1rem","max-width","1400px","width","100%","box-sizing","border-box"],["fxFlex",""],[3,"expanded","opened",4,"ngFor","ngForOf"],["position","end","disableClose","","mode","over",2,"width","1200px","max-width","80%",3,"opened"],[4,"ngIf"],["mode","indeterminate",2,"position","absolute"],["mat-stroked-button","","color","primary",1,"capitalize"],[4,"ngFor","ngForOf"],["mat-menu-item","","class","capitalize",3,"click",4,"ngIf"],["mat-menu-item","",1,"capitalize",3,"click"],[3,"expanded","opened"],[1,"capitalize"],["fxFlex","",3,"dataSource"],["matColumnDef","active"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","name"],["matColumnDef","subject"],["class","subject-column","fxLayoutAlign","space-between center",4,"matCellDef"],["matColumnDef","actions"],["fxFlex","0 0 144px","fxLayoutAlign","flex-end center",4,"matHeaderCellDef"],["fxLayoutAlign","flex-end","fxFlex","0 0 auto",4,"matCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["matTooltip","Change active status","matTooltipPosition","above","disableRipple","",3,"checked","disabled","change"],["fxLayoutAlign","space-between center",1,"subject-column"],["fxLayout","","fxLayoutAlign","center center","fxLayoutGap","0.5rem"],["matTooltip","Last updated","matTooltipPosition","above"],["mat-icon-button","","matTooltip","Edit email details","matTooltipPosition","left","aria-label","Edit email details","color","primary",3,"disabled","click"],["fxFlex","0 0 144px","fxLayoutAlign","flex-end center"],["fxLayoutAlign","flex-end","fxFlex","0 0 auto"],["mat-icon-button","","matTooltip","Open on builder","matTooltipPosition","above","aria-label","Open on builder","color","accent",3,"disabled","click"],["mat-icon-button","","matTooltip","Preview","matTooltipPosition","above","aria-label","Preview","color","accent",3,"disabled","click"],["color","primary"],["mat-flat-button","","color","accent",2,"margin-left","auto",3,"click"],[2,"height","100%","justify-content","center",3,"template"],["fxLayoutGap","0.5rem",2,"margin-left","auto"],["mat-flat-button","","color","accent",3,"click"],[2,"height","inherit",3,"email"],[1,"top-actions"]],template:function(e,t){if(1&e&&(a.Qb(0,"mat-sidenav-container",0),a.Yb("backdropClick",(function(){return t.closeSidenav()})),a.Qb(1,"mat-sidenav-content"),a.Qb(2,"div",1),a.Qb(3,"mat-toolbar",2),a.Ac(4,ne,1,0,"mat-progress-bar",3),a.dc(5,"async"),a.Qb(6,"mat-toolbar-row"),a.Qb(7,"h1"),a.Cc(8,"Email templates"),a.Pb(),a.Qb(9,"div",4),a.Qb(10,"button",5),a.Yb("click",(function(){return t.activeLanguage$.next(t.app.activeLanguage)})),a.Cc(11),a.Pb(),a.Ac(12,ae,3,3,"button",6),a.dc(13,"async"),a.Qb(14,"button",7),a.dc(15,"async"),a.Cc(16," Other languages "),a.Pb(),a.Qb(17,"mat-menu",null,8),a.Ac(19,oe,1,1,"ng-template",9),a.Pb(),a.Pb(),a.Pb(),a.Pb(),a.Qb(20,"div",10),a.Qb(21,"mat-accordion",11),a.Ac(22,Oe,20,7,"mat-expansion-panel",12),a.dc(23,"keyvalue"),a.dc(24,"async"),a.Pb(),a.Pb(),a.Pb(),a.Pb(),a.Qb(25,"mat-sidenav",13),a.dc(26,"async"),a.Ac(27,Qe,9,3,"ng-container",14),a.dc(28,"async"),a.Ac(29,je,14,2,"ng-container",14),a.dc(30,"async"),a.Pb(),a.Pb()),2&e){var n=a.oc(18);a.wb(4),a.ic("ngIf",a.ec(5,9,t.res.isLoading$)),a.wb(7),a.Ec(" ",t.app.activeLanguage," "),a.wb(1),a.ic("ngIf",a.ec(13,11,t.getActiveLanguage$)!==t.app.activeLanguage),a.wb(2),a.ic("matMenuTriggerFor",n)("disabled",a.ec(15,13,t.res.isLoading$)),a.wb(8),a.ic("ngForOf",a.ec(23,15,a.ec(24,17,t.getTemplates$))),a.wb(3),a.ic("opened",a.ec(26,19,t.openSidenav$)),a.wb(2),a.ic("ngIf",a.ec(28,21,t.getTemplateBody$)),a.wb(2),a.ic("ngIf",a.ec(30,23,t.getTemplate$))}},directives:[H.b,H.c,$.c,$.b,$.d,K.a,w.i,K.c,A.a,U.d,U.e,U.a,J.a,$.a,w.h,H.a,V.a,U.b,J.c,J.e,J.f,W.j,W.c,W.e,W.b,W.g,W.i,W.d,W.a,X.a,Z.a,ee.a,W.f,W.h,m.f,m.c],pipes:[w.a,w.e,te,w.d],styles:["[_nghost-%COMP%]{display:block;height:inherit}[_nghost-%COMP%], mat-sidenav-container[_ngcontent-%COMP%]{min-height:inherit}mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:first-child{max-width:84px}mat-cell[_ngcontent-%COMP%]:first-child{max-width:-webkit-fit-content;max-width:-moz-fit-content;max-width:fit-content;padding-right:24px}mat-cell[_ngcontent-%COMP%]:nth-child(2), mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:nth-child(2){max-width:400px;border-right:1px solid #e0e0e0}mat-cell[_ngcontent-%COMP%]:nth-child(3), mat-header-row[_ngcontent-%COMP%]   mat-header-cell[_ngcontent-%COMP%]:nth-child(3){padding-left:24px}.subject-column[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{opacity:0;transition:all .3s ease-in-out;will-change:opacity}.subject-column[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:1}.subject-column[_ngcontent-%COMP%]:hover   button[_ngcontent-%COMP%]:not(:hover){opacity:.5}.mat-drawer-container[_ngcontent-%COMP%]{background:transparent;height:inherit}.force-select[_ngcontent-%COMP%]{-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all;margin-bottom:1rem}"],changeDetection:0}),Ae),Le=(($e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||$e)},$e.\u0275cmp=a.Eb({type:$e,selectors:[["app-campaigns"]],decls:2,vars:0,template:function(e,t){1&e&&(a.Qb(0,"h1"),a.Cc(1,"app-campaigns"),a.Pb())},styles:[""]}),$e);function Te(e,t){1&e&&a.Lb(0,"app-templates")}function Ie(e,t){1&e&&a.Lb(0,"app-campaigns")}var De,Se,Fe,Ee,Re,Me=((De=function e(t,n,a,i){_classCallCheck(this,e);var c=t.nativeElement.dataset,o=c.activeLanguage,r=c.templates,s=c.languages,l=c.mount,b=c.apiBase,u=c.mergeFields,m=c.csrfToken,d=c.csrfName;a.activeLanguage=o,a.mergeFields=JSON.parse(u),a.languages=JSON.parse(s),a.templatesCache.set(o,JSON.parse(r)),this.mount=l,n.init(b,d,m),i.uploadImagePath="".concat(b,"/upload"),i.csrf={name:d,token:p("csrf_cookie_name")||m}}).\u0275fac=function(e){return new(e||De)(a.Kb(a.j),a.Kb(v),a.Kb(y),a.Kb(m.b))},De.\u0275cmp=a.Eb({type:De,selectors:[["app-root"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["campaigns",""]],template:function(e,t){if(1&e&&(a.Ac(0,Te,1,0,"app-templates",0),a.Ac(1,Ie,1,0,"ng-template",null,1,a.Bc)),2&e){var n=a.oc(2);a.ic("ngIf","templates"===t.mount)("ngIfElse",n)}},directives:[w.i,_e,Le],styles:["[_nghost-%COMP%] {\n      display: block;\n      height: inherit;\n      min-height: inherit;\n    }"]}),De),Ne=n("jhN1"),Be=n("R1ws"),Ye=n("sYmb"),qe=n("d3UM"),ze=n("Wp6s"),Ge=n("A5z7"),He=n("YUcS"),Ke=n("wZkO"),Ue=((Re=function e(){_classCallCheck(this,e)}).\u0275mod=a.Ib({type:Re}),Re.\u0275inj=a.Hb({factory:function(e){return new(e||Re)},imports:[[],w.b,T.b,qe.b,ee.b,_.m,He.a,ze.a,A.b,_.d,Ye.b,Z.b,Ge.a,W.k,K.b,U.c,Ke.d,J.b,H.d,V.b,I.d,j.f,X.b]}),Re),Je=((Ee=function e(){_classCallCheck(this,e)}).\u0275mod=a.Ib({type:Ee}),Ee.\u0275inj=a.Hb({factory:function(e){return new(e||Ee)},imports:[[Ue,m.d.forChild({xApiKey:"ULMnDh2ens78ge40yU29Q7bbF6r0N5B96VNbebCJ",useDownloadButton:!1,useSaveButton:!1})]]}),Ee),Ve=((Fe=function e(){_classCallCheck(this,e)}).\u0275mod=a.Ib({type:Fe}),Fe.\u0275inj=a.Hb({factory:function(e){return new(e||Fe)},imports:[[w.b]]}),Fe),We=((Se=function e(){_classCallCheck(this,e)}).\u0275mod=a.Ib({type:Se,bootstrap:[Me]}),Se.\u0275inj=a.Hb({factory:function(e){return new(e||Se)},imports:[[Ne.a,Be.b,Ue,Je,Ve]]}),Se);Object(a.N)(),Ne.d().bootstrapModule(We).catch((function(e){return console.error(e)}))}},[[0,0,5]]]);